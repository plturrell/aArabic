version: "3.9"

services:
  # Main nWorkflow application with SAP-only integration
  nworkflow:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nworkflow
    ports:
      - "8090:8090"
    environment:
      # SAP HANA Cloud Configuration
      - NWORKFLOW_PORT=8090
      - HANA_HOST=${HANA_HOST:-localhost}
      - HANA_PORT=${HANA_PORT:-443}
      - HANA_USER=${HANA_USER:-DBADMIN}
      - HANA_PASSWORD=${HANA_PASSWORD}
      - HANA_SCHEMA=${HANA_SCHEMA:-DBADMIN}
      - HANA_USE_TLS=${HANA_USE_TLS:-true}
      # SAP BTP Configuration
      - BTP_SUBACCOUNT=${BTP_SUBACCOUNT}
      - BTP_CLIENT_ID=${BTP_CLIENT_ID}
      - BTP_CLIENT_SECRET=${BTP_CLIENT_SECRET}
      - BTP_TOKEN_URL=${BTP_TOKEN_URL}
      # SAP Destination Service
      - DESTINATION_SERVICE_URL=${DESTINATION_SERVICE_URL}
      # SAP XSUAA/IAS for Security
      - XSUAA_URL=${XSUAA_URL}
      - XSUAA_CLIENT_ID=${XSUAA_CLIENT_ID}
      - XSUAA_CLIENT_SECRET=${XSUAA_CLIENT_SECRET}
    networks:
      - nworkflow-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8090/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  nworkflow-network:
    driver: bridge
    name: nworkflow-network

# Note: SAP HANA Cloud is accessed as an external service via BTP
# No local database containers are needed - all data storage uses SAP HANA Cloud
# SAP BTP services (Destination, XSUAA, etc.) are accessed via their cloud endpoints