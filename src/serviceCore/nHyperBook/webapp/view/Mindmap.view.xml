<mvc:View
    controllerName="hypershimmy.controller.Mindmap"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:html="http://www.w3.org/1999/xhtml">
    
    <Page
        id="mindmap"
        title="{i18n>mindmapTitle}"
        showNavButton="true"
        navButtonPress=".onNavBack">
        
        <headerContent>
            <MenuButton
                text="{i18n>mindmapExportButton}"
                icon="sap-icon://download"
                enabled="{= ${appState>/mindmapGenerated} }">
                <menu>
                    <Menu>
                        <MenuItem
                            text="{i18n>mindmapExportJSON}"
                            icon="sap-icon://document"
                            press=".onExportMindmap"/>
                        <MenuItem
                            text="{i18n>mindmapExportSVG}"
                            icon="sap-icon://picture"
                            press=".onExportSVG"/>
                        <MenuItem
                            text="{i18n>mindmapExportPNG}"
                            icon="sap-icon://camera"
                            press=".onExportPNG"/>
                    </Menu>
                </menu>
            </MenuButton>
            <Button
                icon="sap-icon://full-screen"
                tooltip="{i18n>mindmapFullscreenButton}"
                press=".onToggleFullscreen"
                enabled="{= ${appState>/mindmapGenerated} }"/>
            <Button
                icon="sap-icon://reset"
                tooltip="{i18n>mindmapResetButton}"
                press=".onResetView"
                enabled="{= ${appState>/mindmapGenerated} }"/>
        </headerContent>
        
        <content>
            <VBox class="hypershimmyMindmap" height="100%">
                
                <!-- Configuration Panel -->
                <Panel
                    headerText="{i18n>mindmapConfigTitle}"
                    expandable="true"
                    expanded="{appState>/mindmapConfigExpanded}"
                    class="sapUiSmallMargin">
                    
                    <VBox class="sapUiSmallMargin">
                        
                        <!-- Layout Algorithm Selection -->
                        <Label
                            text="{i18n>mindmapLayoutLabel}"
                            labelFor="layoutSelect"
                            class="sapUiTinyMarginTop"/>
                        <Select
                            id="layoutSelect"
                            selectedKey="{appState>/mindmapLayout}"
                            change=".onLayoutChange"
                            width="100%"
                            class="sapUiTinyMarginBottom">
                            <items>
                                <core:Item key="tree" text="{i18n>mindmapLayoutTree}"/>
                                <core:Item key="radial" text="{i18n>mindmapLayoutRadial}"/>
                            </items>
                        </Select>
                        
                        <!-- Layout Description -->
                        <Text
                            text="{appState>/mindmapLayoutDescription}"
                            class="sapUiTinyMarginBottom mindmapLayoutDescription"/>
                        
                        <!-- Max Depth Slider -->
                        <Label
                            text="{i18n>mindmapMaxDepthLabel}"
                            class="sapUiSmallMarginTop"/>
                        <Slider
                            id="maxDepthSlider"
                            min="2"
                            max="10"
                            step="1"
                            value="{appState>/mindmapMaxDepth}"
                            enableTickmarks="true"
                            width="100%"
                            class="sapUiTinyMarginBottom"/>
                        <Text
                            text="{= ${appState>/mindmapMaxDepth} + ' levels' }"
                            class="sapUiTinyMarginBottom"/>
                        
                        <!-- Max Children Slider -->
                        <Label
                            text="{i18n>mindmapMaxChildrenLabel}"
                            class="sapUiSmallMarginTop"/>
                        <Slider
                            id="maxChildrenSlider"
                            min="3"
                            max="20"
                            step="1"
                            value="{appState>/mindmapMaxChildren}"
                            enableTickmarks="true"
                            width="100%"
                            class="sapUiTinyMarginBottom"/>
                        <Text
                            text="{= ${appState>/mindmapMaxChildren} + ' children per node' }"
                            class="sapUiTinyMarginBottom"/>
                        
                        <!-- Canvas Size -->
                        <Label
                            text="{i18n>mindmapCanvasSizeLabel}"
                            class="sapUiSmallMarginTop"/>
                        <HBox class="sapUiTinyMarginBottom">
                            <StepInput
                                id="canvasWidthInput"
                                value="{appState>/mindmapCanvasWidth}"
                                min="800"
                                max="3000"
                                step="100"
                                width="150px"
                                displayValuePrecision="0"/>
                            <Label text="×" class="sapUiTinyMarginBegin sapUiTinyMarginEnd"/>
                            <StepInput
                                id="canvasHeightInput"
                                value="{appState>/mindmapCanvasHeight}"
                                min="600"
                                max="2000"
                                step="100"
                                width="150px"
                                displayValuePrecision="0"/>
                        </HBox>
                        
                        <!-- Auto Select Root -->
                        <CheckBox
                            text="{i18n>mindmapAutoSelectRoot}"
                            selected="{appState>/mindmapAutoSelectRoot}"
                            class="sapUiTinyMarginTop"/>
                        
                        <!-- Generate Button -->
                        <Button
                            text="{i18n>mindmapGenerateButton}"
                            type="Emphasized"
                            icon="sap-icon://map-2"
                            press=".onGenerateMindmap"
                            enabled="{= !${appState>/busy} }"
                            width="100%"
                            class="sapUiSmallMarginTop"/>
                    </VBox>
                </Panel>
                
                <!-- Mindmap Display Area -->
                <VBox
                    height="100%"
                    width="100%"
                    class="sapUiSmallMargin mindmapContainer">
                    
                    <!-- Loading Indicator -->
                    <VBox
                        visible="{appState>/busy}"
                        alignItems="Center"
                        justifyContent="Center"
                        class="sapUiLargeMarginTop">
                        <BusyIndicator size="3rem" class="sapUiMediumMarginBottom"/>
                        <Title text="{i18n>mindmapGeneratingTitle}" class="sapUiTinyMarginBottom"/>
                        <Text text="{i18n>mindmapGeneratingText}"/>
                    </VBox>
                    
                    <!-- Empty State -->
                    <VBox
                        visible="{= !${appState>/busy} &amp;&amp; !${appState>/mindmapGenerated} }"
                        alignItems="Center"
                        justifyContent="Center"
                        class="sapUiLargeMarginTop">
                        <core:Icon
                            src="sap-icon://map-2"
                            size="4rem"
                            color="#0070f2"
                            class="sapUiMediumMarginBottom"/>
                        <Title text="{i18n>mindmapEmptyTitle}" class="sapUiTinyMarginBottom"/>
                        <Text text="{i18n>mindmapEmptyText}"/>
                    </VBox>
                    
                    <!-- Mindmap Canvas -->
                    <VBox
                        id="mindmapCanvas"
                        visible="{= !${appState>/busy} &amp;&amp; ${appState>/mindmapGenerated} }"
                        class="mindmapCanvas">
                        
                        <!-- Canvas Header -->
                        <HBox
                            justifyContent="SpaceBetween"
                            alignItems="Center"
                            class="sapUiSmallMarginBottom mindmapHeader">
                            <VBox>
                                <Title
                                    text="{appState>/currentMindmap/Title}"
                                    level="H2"/>
                                <Text
                                    text="{= 'Layout: ' + ${appState>/currentMindmap/LayoutAlgorithm} + ' • Nodes: ' + ${appState>/currentMindmap/NodeCount} + ' • Edges: ' + ${appState>/currentMindmap/EdgeCount} }"
                                    class="mindmapMetadata"/>
                            </VBox>
                            <HBox>
                                <ObjectStatus
                                    text="{= 'Depth: ' + ${appState>/currentMindmap/MaxDepth} }"
                                    state="Information"
                                    icon="sap-icon://tree"/>
                            </HBox>
                        </HBox>
                        
                        <!-- Search Bar -->
                        <SearchField
                            id="mindmapSearch"
                            placeholder="{i18n>mindmapSearchPlaceholder}"
                            value="{appState>/mindmapSearchQuery}"
                            search=".onSearchNodes"
                            liveChange=".onSearchNodes"
                            width="100%"
                            class="sapUiSmallMarginBottom mindmapSearchBar"/>
                        
                        <!-- Control Bar -->
                        <HBox
                            justifyContent="SpaceBetween"
                            alignItems="Center"
                            class="sapUiSmallMarginBottom mindmapControlBar">
                            
                            <!-- Left: Expand/Collapse Controls -->
                            <HBox>
                                <Button
                                    text="{i18n>mindmapExpandAll}"
                                    icon="sap-icon://expand-group"
                                    press=".onExpandAll"
                                    type="Transparent"/>
                                <Button
                                    text="{i18n>mindmapCollapseAll}"
                                    icon="sap-icon://collapse-group"
                                    press=".onCollapseAll"
                                    type="Transparent"/>
                            </HBox>
                            
                            <!-- Right: Zoom Controls -->
                            <HBox>
                                <Button
                                    icon="sap-icon://zoom-in"
                                    tooltip="{i18n>mindmapZoomIn}"
                                    press=".onZoomIn"
                                    type="Transparent"/>
                                <Button
                                    icon="sap-icon://zoom-out"
                                    tooltip="{i18n>mindmapZoomOut}"
                                    press=".onZoomOut"
                                    type="Transparent"/>
                                <Text
                                    text="{= ${appState>/mindmapZoom} + '%' }"
                                    class="mindmapZoomLevel"/>
                                <Button
                                    icon="sap-icon://reset"
                                    tooltip="{i18n>mindmapResetZoom}"
                                    press=".onResetZoom"
                                    type="Transparent"/>
                            </HBox>
                        </HBox>
                        
                        <!-- SVG Canvas Container with Minimap -->
                        <VBox class="sapUiNoMargin" style="position:relative;">
                            <ScrollContainer
                                id="mindmapScroll"
                                height="600px"
                                width="100%"
                                vertical="true"
                                horizontal="true"
                                class="mindmapScrollContainer">
                                <html:div id="mindmapSvgContainer" class="mindmapSvgContainer">
                                    <!-- SVG will be injected here by controller -->
                                </html:div>
                            </ScrollContainer>
                            
                            <!-- Minimap Overlay -->
                            <html:div id="mindmapMinimap" class="mindmapMinimapContainer">
                                <!-- Minimap SVG will be injected here by controller -->
                            </html:div>
                        </VBox>
                        
                        <!-- Pan Instructions -->
                        <MessageStrip
                            text="{i18n>mindmapPanInstructions}"
                            type="Information"
                            showIcon="true"
                            class="sapUiTinyMarginTop"/>
                        
                        <!-- Node Details Panel -->
                        <Panel
                            headerText="{i18n>mindmapNodeDetails}"
                            visible="{= ${appState>/selectedNode} !== null }"
                            class="sapUiSmallMarginTop">
                            <VBox class="sapUiSmallMargin">
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Node ID:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/selectedNode/Id}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Label:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/selectedNode/Label}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Type:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/selectedNode/NodeType}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Entity Type:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/selectedNode/EntityType}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Level:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/selectedNode/Level}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Children:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/selectedNode/ChildCount}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Confidence:" class="mindmapDetailLabel"/>
                                    <Text text="{= (${appState>/selectedNode/Confidence} * 100).toFixed(1) + '%' }"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Position:" class="mindmapDetailLabel"/>
                                    <Text text="{= '(' + ${appState>/selectedNode/X}.toFixed(0) + ', ' + ${appState>/selectedNode/Y}.toFixed(0) + ')' }"/>
                                </HBox>
                            </VBox>
                        </Panel>
                        
                        <!-- Statistics Panel -->
                        <Panel
                            headerText="{i18n>mindmapStatistics}"
                            expandable="true"
                            expanded="false"
                            class="sapUiSmallMarginTop">
                            <VBox class="sapUiSmallMargin">
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Mindmap ID:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/currentMindmap/MindmapId}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Root Node:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/currentMindmap/RootNodeId}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Total Nodes:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/currentMindmap/NodeCount}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Total Edges:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/currentMindmap/EdgeCount}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Max Depth:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/currentMindmap/MaxDepth}"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Processing Time:" class="mindmapDetailLabel"/>
                                    <Text text="{= ${appState>/currentMindmap/ProcessingTimeMs} + 'ms' }"/>
                                </HBox>
                                <HBox class="sapUiTinyMarginBottom">
                                    <Label text="Generated:" class="mindmapDetailLabel"/>
                                    <Text text="{appState>/mindmapGeneratedTime}"/>
                                </HBox>
                            </VBox>
                        </Panel>
                    </VBox>
                </VBox>
            </VBox>
        </content>
    </Page>
    
</mvc:View>
