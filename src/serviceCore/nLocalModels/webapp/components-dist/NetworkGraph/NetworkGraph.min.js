var H={brand:"#0070f2",success:"#30914c",warning:"#df6e0c",error:"#cc1919",neutral:"#6c757d",background:"#f7f7f7",backgroundAlt:"#ffffff",border:"#d9d9d9",text:"#32363a",textMuted:"#6c757d"},q={nodeRadius:40,nodeStrokeWidth:2,edgeStrokeWidth:2,arrowSize:8,fontSize:14,iconSize:24,showLabels:!0,showMetrics:!0,enableAnimations:!0,theme:"light"},T={repulsion:1000,attraction:0.01,gravity:0.1,damping:0.9,maxVelocity:10},N={x:0,y:0,scale:1,width:800,height:600};class k{id;name;description;type;status;model;metrics;group;shape;position;velocity;force;mass;radius;fixed;rectWidth=120;rectHeight=80;element;circle=null;rect=null;icon;label;statusIndicator;halo;expandButton=null;isSelected=!1;isHovered=!1;isDragging=!1;expandState="collapsed";hasChildren=!1;onExpandClickCallback=null;constructor(J){this.id=J.id,this.name=J.name,this.description=J.description||"",this.type=J.type,this.status=J.status,this.model=J.model||"N/A",this.metrics=J.metrics||{totalRequests:0,avgLatency:0,successRate:0},this.group=J.group||null,this.shape=J.shape||"circle",this.position=J.position||this.randomPosition(),this.velocity={x:0,y:0},this.force={x:0,y:0},this.mass=1,this.radius=q.nodeRadius,this.fixed=!1,this.element=this.createElement()}createElement(){let J=document.createElementNS("http://www.w3.org/2000/svg","g");if(J.setAttribute("class","graph-node"),J.setAttribute("data-node-id",this.id),J.setAttribute("data-node-type",this.type),J.setAttribute("data-node-shape",this.shape),this.halo=this.createHalo(),J.appendChild(this.halo),this.shape==="rectangle")this.rect=this.createRect(),J.appendChild(this.rect);else this.circle=this.createCircle(),J.appendChild(this.circle);return this.statusIndicator=this.createStatusIndicator(),J.appendChild(this.statusIndicator),this.icon=this.createIcon(),J.appendChild(this.icon),this.label=this.createLabel(),J.appendChild(this.label),this.expandButton=this.renderExpandButton(),J.appendChild(this.expandButton),this.updatePosition(),J}createHalo(){if(this.shape==="rectangle"){let J=document.createElementNS("http://www.w3.org/2000/svg","rect");return J.setAttribute("class","node-halo"),J.setAttribute("x",(-(this.rectWidth/2)-8).toString()),J.setAttribute("y",(-(this.rectHeight/2)-8).toString()),J.setAttribute("width",(this.rectWidth+16).toString()),J.setAttribute("height",(this.rectHeight+16).toString()),J.setAttribute("rx","12"),J.setAttribute("ry","12"),J.setAttribute("fill","none"),J.setAttribute("stroke",H.brand),J.setAttribute("stroke-width","3"),J.setAttribute("opacity","0"),J}else{let J=document.createElementNS("http://www.w3.org/2000/svg","circle");return J.setAttribute("class","node-halo"),J.setAttribute("r",(this.radius+8).toString()),J.setAttribute("fill","none"),J.setAttribute("stroke",H.brand),J.setAttribute("stroke-width","3"),J.setAttribute("opacity","0"),J}}createRect(){let J=document.createElementNS("http://www.w3.org/2000/svg","rect");return J.setAttribute("class","node-rect graph-node-rect"),J.setAttribute("x",(-this.rectWidth/2).toString()),J.setAttribute("y",(-this.rectHeight/2).toString()),J.setAttribute("width",this.rectWidth.toString()),J.setAttribute("height",this.rectHeight.toString()),J.setAttribute("rx","8"),J.setAttribute("ry","8"),J.setAttribute("fill",this.getStatusColor()),J.setAttribute("stroke","#ffffff"),J.setAttribute("stroke-width","2"),J.setAttribute("filter","url(#nodeRectShadow)"),J.style.cursor="pointer",J.style.transition="all 0.3s ease",J}createCircle(){let J=document.createElementNS("http://www.w3.org/2000/svg","circle");return J.setAttribute("class","node-circle"),J.setAttribute("r",this.radius.toString()),J.setAttribute("fill",this.getStatusColor()),J.setAttribute("stroke","#ffffff"),J.setAttribute("stroke-width","2"),J.setAttribute("filter","url(#nodeShadow)"),J.style.cursor="pointer",J.style.transition="all 0.3s ease",J}createStatusIndicator(){let J=document.createElementNS("http://www.w3.org/2000/svg","circle");return J.setAttribute("class","status-indicator"),J.setAttribute("r","8"),J.setAttribute("fill",this.getStatusColor()),J.setAttribute("stroke","#ffffff"),J.setAttribute("stroke-width","2"),J}createIcon(){let J=document.createElementNS("http://www.w3.org/2000/svg","text");return J.setAttribute("class","node-icon"),J.setAttribute("text-anchor","middle"),J.setAttribute("dominant-baseline","central"),J.setAttribute("font-size","24"),J.setAttribute("fill","#ffffff"),J.setAttribute("pointer-events","none"),J.textContent=this.getIconText(),J}createLabel(){let J=document.createElementNS("http://www.w3.org/2000/svg","text");return J.setAttribute("class","node-label"),J.setAttribute("text-anchor","middle"),J.setAttribute("font-size","12"),J.setAttribute("font-weight","bold"),J.setAttribute("fill",H.text),J.setAttribute("pointer-events","none"),J.textContent=this.name,J}renderExpandButton(){let J=document.createElementNS("http://www.w3.org/2000/svg","g");J.setAttribute("class","node-expand-button");let K=Math.PI/4,Z=this.radius*Math.cos(K),$=this.radius*Math.sin(K);J.setAttribute("transform",`translate(${Z}, ${$})`);let V=document.createElementNS("http://www.w3.org/2000/svg","circle");V.setAttribute("class","expand-button-bg"),V.setAttribute("r","10"),V.setAttribute("fill",H.brand),V.setAttribute("stroke","#ffffff"),V.setAttribute("stroke-width","2"),V.style.cursor="pointer",J.appendChild(V);let B=document.createElementNS("http://www.w3.org/2000/svg","text");return B.setAttribute("class","expand-button-icon"),B.setAttribute("text-anchor","middle"),B.setAttribute("dominant-baseline","central"),B.setAttribute("font-size","10"),B.setAttribute("fill","#ffffff"),B.setAttribute("pointer-events","none"),B.textContent=this.getExpandIcon(),J.appendChild(B),J.style.display=this.hasChildren?"block":"none",J.addEventListener("click",(W)=>{if(W.stopPropagation(),this.onExpandClickCallback)this.onExpandClickCallback(this.id,this.expandState)}),J}getExpandIcon(){switch(this.expandState){case"expanded":return"▼";case"partial":return"◐";case"collapsed":default:return"▶"}}setExpandState(J){if(this.expandState=J,this.expandButton){let K=this.expandButton.querySelector(".expand-button-icon");if(K)K.textContent=this.getExpandIcon();let Z=this.expandButton.querySelector(".expand-button-bg");if(Z)switch(J){case"expanded":Z.setAttribute("fill",H.success);break;case"partial":Z.setAttribute("fill",H.warning);break;case"collapsed":default:Z.setAttribute("fill",H.brand);break}if(q.enableAnimations)this.expandButton.animate([{transform:`translate(${this.radius*Math.cos(Math.PI/4)}, ${this.radius*Math.sin(Math.PI/4)}) scale(1.3)`},{transform:`translate(${this.radius*Math.cos(Math.PI/4)}, ${this.radius*Math.sin(Math.PI/4)}) scale(1.0)`}],{duration:200,easing:"ease-out"})}}setHasChildren(J){if(this.hasChildren=J,this.expandButton)this.expandButton.style.display=J?"block":"none"}onExpandClick(J){this.onExpandClickCallback=J}updatePosition(){if(!this.element)return;if(this.element.setAttribute("transform",`translate(${this.position.x}, ${this.position.y})`),this.shape==="rectangle"){let J=this.rectWidth/2-8,K=-this.rectHeight/2+8;this.statusIndicator.setAttribute("cx",J.toString()),this.statusIndicator.setAttribute("cy",K.toString())}else{let J=-Math.PI/4,K=this.radius*Math.cos(J),Z=this.radius*Math.sin(J);this.statusIndicator.setAttribute("cx",K.toString()),this.statusIndicator.setAttribute("cy",Z.toString())}}applyForce(J,K){if(this.fixed)return;this.force.x+=J,this.force.y+=K}updatePhysics(J=1){if(this.fixed)return;let K=this.force.x/this.mass,Z=this.force.y/this.mass;this.velocity.x+=K*J,this.velocity.y+=Z*J,this.velocity.x*=0.9,this.velocity.y*=0.9;let $=Math.sqrt(this.velocity.x**2+this.velocity.y**2);if($>10)this.velocity.x=this.velocity.x/$*10,this.velocity.y=this.velocity.y/$*10;this.position.x+=this.velocity.x*J,this.position.y+=this.velocity.y*J,this.force.x=0,this.force.y=0,this.updatePosition()}setStatus(J){this.status=J;let K=this.getStatusColor(),Z=this.getShapeElement();if(Z)Z.setAttribute("fill",K);if(this.statusIndicator.setAttribute("fill",K),q.enableAnimations)this.pulse()}setSelected(J){this.isSelected=J;let K=this.getShapeElement();if(J){if(this.halo.setAttribute("opacity","1"),K)K.setAttribute("stroke-width","4");this.element.style.filter="drop-shadow(0 4px 8px rgba(0,0,0,0.3))"}else{if(this.halo.setAttribute("opacity","0"),K)K.setAttribute("stroke-width","2");this.element.style.filter=""}}setHovered(J){this.isHovered=J;let K=this.getShapeElement();if(J){if(this.halo.setAttribute("opacity","0.5"),K)K.style.transform="scale(1.1)"}else if(!this.isSelected){if(this.halo.setAttribute("opacity","0"),K)K.style.transform="scale(1.0)"}}setDragging(J){this.isDragging=J,this.fixed=J;let K=this.getShapeElement();if(J){if(this.element.style.cursor="grabbing",K)K.style.opacity="0.8"}else if(this.element.style.cursor="pointer",K)K.style.opacity="1.0"}getShapeElement(){return this.shape==="rectangle"?this.rect:this.circle}pulse(){let J=this.getShapeElement();if(!J)return;J.animate([{transform:"scale(1.0)"},{transform:"scale(1.2)",offset:0.5},{transform:"scale(1.0)"}],{duration:600,easing:"ease-out"})}highlight(){this.element.style.filter="drop-shadow(0 0 10px "+this.getStatusColor()+")",setTimeout(()=>{this.element.style.filter=""},1000)}startPulseLoop(){if(this.status==="Running"){let J=()=>{if(this.status==="Running")this.pulse(),setTimeout(J,1500)};J()}}getStatusColor(){switch(this.status){case"Success":return H.success;case"Warning":return H.warning;case"Error":return H.error;case"Running":return H.brand;case"None":default:return H.neutral}}getIconText(){return{code_intelligence:"\uD83D\uDCDD",vector_search:"\uD83D\uDD0D",graph_database:"\uD83D\uDD78️",verification:"✓",workflow:"⚙️",lineage:"\uD83D\uDCCA",orchestrator:"\uD83C\uDFAF",router:"\uD83D\uDD00",translation:"\uD83C\uDF10",rag:"\uD83D\uDCDA"}[this.type]||"⚡"}randomPosition(){let J=Math.random()*2*Math.PI,K=Math.random()*200+100;return{x:Math.cos(J)*K,y:Math.sin(J)*K}}distanceTo(J){let K=this.position.x-J.position.x,Z=this.position.y-J.position.y;return Math.sqrt(K*K+Z*Z)}angleTo(J){let K=J.position.x-this.position.x,Z=J.position.y-this.position.y;return Math.atan2(Z,K)}overlaps(J){let K=this.radius+J.radius;return this.distanceTo(J)<K}containsPoint(J){let K=J.x-this.position.x,Z=J.y-this.position.y;if(this.shape==="rectangle")return Math.abs(K)<=this.rectWidth/2&&Math.abs(Z)<=this.rectHeight/2;else return Math.sqrt(K*K+Z*Z)<=this.radius}getWidth(){return this.shape==="rectangle"?this.rectWidth:this.radius*2}getHeight(){return this.shape==="rectangle"?this.rectHeight:this.radius*2}toJSON(){return{id:this.id,name:this.name,description:this.description,type:this.type,status:this.status,model:this.model,metrics:this.metrics,group:this.group||void 0,position:{...this.position},shape:this.shape}}destroy(){if(this.element&&this.element.parentNode)this.element.parentNode.removeChild(this.element)}}class G{id;from;to;label;status;animated;element;path;arrowHead;labelText;flowCircle;sourceNode=null;targetNode=null;flowAnimation=null;constructor(J){this.id=J.id,this.from=J.from,this.to=J.to,this.label=J.label||"",this.status=J.status||"Inactive",this.animated=J.animated||!1,this.element=this.createElement()}createElement(){let J=document.createElementNS("http://www.w3.org/2000/svg","g");if(J.setAttribute("class","graph-edge"),J.setAttribute("data-edge-id",this.id),J.setAttribute("data-from",this.from),J.setAttribute("data-to",this.to),this.path=this.createPath(),J.appendChild(this.path),this.arrowHead=this.createArrowHead(),J.appendChild(this.arrowHead),this.flowCircle=this.createFlowCircle(),J.appendChild(this.flowCircle),this.label)this.labelText=this.createLabel(),J.appendChild(this.labelText);return J}createPath(){let J=document.createElementNS("http://www.w3.org/2000/svg","path");if(J.setAttribute("class","edge-path"),J.setAttribute("fill","none"),J.setAttribute("stroke",this.getStatusColor()),J.setAttribute("stroke-width",q.edgeStrokeWidth.toString()),J.setAttribute("stroke-linecap","round"),J.style.transition="stroke 0.3s ease",this.status==="Inactive")J.setAttribute("stroke-dasharray","5,5");return J}createArrowHead(){let J=document.createElementNS("http://www.w3.org/2000/svg","polygon");return J.setAttribute("class","edge-arrow"),J.setAttribute("fill",this.getStatusColor()),J.style.transition="fill 0.3s ease",J}createFlowCircle(){let J=document.createElementNS("http://www.w3.org/2000/svg","circle");return J.setAttribute("class","edge-flow"),J.setAttribute("r","4"),J.setAttribute("fill",H.brand),J.setAttribute("opacity","0"),J}createLabel(){let J=document.createElementNS("http://www.w3.org/2000/svg","text");return J.setAttribute("class","edge-label"),J.setAttribute("text-anchor","middle"),J.setAttribute("font-size","10"),J.setAttribute("fill",H.textMuted),J.setAttribute("pointer-events","none"),J.textContent=this.label,J}setNodes(J,K){this.sourceNode=J,this.targetNode=K,this.updatePath()}updatePath(){if(!this.sourceNode||!this.targetNode)return;let J=this.sourceNode.position,K=this.targetNode.position,Z=Math.atan2(K.y-J.y,K.x-J.x),$={x:J.x+this.sourceNode.radius*Math.cos(Z),y:J.y+this.sourceNode.radius*Math.sin(Z)},V={x:K.x-this.targetNode.radius*Math.cos(Z),y:K.y-this.targetNode.radius*Math.sin(Z)},B=this.createBezierPath($,V);if(this.path.setAttribute("d",B),this.positionArrowHead(V,Z),this.labelText){let W=($.x+V.x)/2,z=($.y+V.y)/2;this.labelText.setAttribute("x",W.toString()),this.labelText.setAttribute("y",(z-10).toString())}}createBezierPath(J,K){let Z=K.x-J.x,$=K.y-J.y,V=Math.sqrt(Z*Z+$*$),B=0.2,W=V*0.2,Q=Math.atan2($,Z)+Math.PI/2,j=J.x+Z*0.33+W*Math.cos(Q),M=J.y+$*0.33+W*Math.sin(Q),U=J.x+Z*0.67+W*Math.cos(Q),F=J.y+$*0.67+W*Math.sin(Q);if(V<100)return`M ${J.x} ${J.y} L ${K.x} ${K.y}`;return`M ${J.x} ${J.y} C ${j} ${M}, ${U} ${F}, ${K.x} ${K.y}`}positionArrowHead(J,K){let Z=q.arrowSize,$=J,V={x:$.x-Z*Math.cos(K-Math.PI/6),y:$.y-Z*Math.sin(K-Math.PI/6)},B={x:$.x-Z*Math.cos(K+Math.PI/6),y:$.y-Z*Math.sin(K+Math.PI/6)},W=`${$.x},${$.y} ${V.x},${V.y} ${B.x},${B.y}`;this.arrowHead.setAttribute("points",W)}setStatus(J){this.status=J;let K=this.getStatusColor();if(this.path.setAttribute("stroke",K),this.arrowHead.setAttribute("fill",K),J==="Inactive")this.path.setAttribute("stroke-dasharray","5,5");else this.path.removeAttribute("stroke-dasharray");if(J==="Flowing"||J==="Active")this.startFlowAnimation();else this.stopFlowAnimation()}setHighlighted(J){if(J)this.path.setAttribute("stroke-width","4"),this.element.style.filter="drop-shadow(0 2px 4px rgba(0,0,0,0.3))";else this.path.setAttribute("stroke-width",q.edgeStrokeWidth.toString()),this.element.style.filter=""}startFlowAnimation(){if(this.flowAnimation)return;this.flowCircle.setAttribute("opacity","1"),this.flowAnimation=this.flowCircle.animate([{offsetDistance:"0%"},{offsetDistance:"100%"}],{duration:2000,iterations:1/0,easing:"linear"}),this.flowCircle.style.offsetPath=`path("${this.path.getAttribute("d")}")`}stopFlowAnimation(){if(this.flowAnimation)this.flowAnimation.cancel(),this.flowAnimation=null;this.flowCircle.setAttribute("opacity","0")}pulse(){this.element.animate([{opacity:1},{opacity:0.5,offset:0.5},{opacity:1}],{duration:800,easing:"ease-in-out"})}flash(){this.path.animate([{stroke:this.getStatusColor()},{stroke:H.brand},{stroke:this.getStatusColor()}],{duration:400,easing:"ease-out"})}getStatusColor(){switch(this.status){case"Active":return H.brand;case"Flowing":return H.success;case"Error":return H.error;case"Inactive":default:return H.neutral}}getLength(){if(!this.sourceNode||!this.targetNode)return 0;let J=this.targetNode.position.x-this.sourceNode.position.x,K=this.targetNode.position.y-this.sourceNode.position.y;return Math.sqrt(J*J+K*K)}getMidpoint(){if(!this.sourceNode||!this.targetNode)return{x:0,y:0};return{x:(this.sourceNode.position.x+this.targetNode.position.x)/2,y:(this.sourceNode.position.y+this.targetNode.position.y)/2}}containsPoint(J,K=5){if(!this.sourceNode||!this.targetNode)return!1;let Z=this.sourceNode.position,$=this.targetNode.position,V=$.x-Z.x,B=$.y-Z.y,W=V*V+B*B;if(W===0){let A=J.x-Z.x,L=J.y-Z.y;return Math.sqrt(A*A+L*L)<=K}let z=Math.max(0,Math.min(1,((J.x-Z.x)*V+(J.y-Z.y)*B)/W)),Q=Z.x+z*V,j=Z.y+z*B,M=J.x-Q,U=J.y-j;return Math.sqrt(M*M+U*U)<=K}toJSON(){return{id:this.id,from:this.from,to:this.to,label:this.label,status:this.status,animated:this.animated}}destroy(){if(this.stopFlowAnimation(),this.element&&this.element.parentNode)this.element.parentNode.removeChild(this.element)}}class D{nodes=[];edges=[];config;alpha=1;alphaDecay=0.95;animationFrame=null;constructor(J){this.config={type:"force-directed",animate:!0,duration:1000,forces:T,padding:50,...J}}setNodes(J){this.nodes=J}setEdges(J){this.edges=J}setConfig(J){this.config={...this.config,...J}}start(){switch(this.alpha=1,this.config.type){case"force-directed":this.startForceDirectedLayout();break;case"hierarchical":this.applyHierarchicalLayout();break;case"circular":this.applyCircularLayout();break;case"grid":this.applyGridLayout();break;case"manual":break}}stop(){if(this.animationFrame)cancelAnimationFrame(this.animationFrame),this.animationFrame=null;this.alpha=0}tick(){if(this.alpha<=0.01){this.stop();return}if(this.config.type==="force-directed")this.tickForceDirected();this.alpha*=this.alphaDecay}startForceDirectedLayout(){if(!this.config.animate){while(this.alpha>0.01)this.tickForceDirected(),this.alpha*=this.alphaDecay;return}let J=()=>{if(this.tickForceDirected(),this.alpha*=this.alphaDecay,this.alpha>0.01)this.animationFrame=requestAnimationFrame(J)};J()}tickForceDirected(){let J=this.config.forces||T;for(let $ of this.nodes)$.force.x=0,$.force.y=0;for(let $=0;$<this.nodes.length;$++)for(let V=$+1;V<this.nodes.length;V++)this.applyRepulsionForce(this.nodes[$],this.nodes[V],J.repulsion);for(let $ of this.edges){let V=this.nodes.find((W)=>W.id===$.from),B=this.nodes.find((W)=>W.id===$.to);if(V&&B)this.applyAttractionForce(V,B,J.attraction)}let K=0,Z=0;for(let $ of this.nodes)this.applyGravityForce($,K,Z,J.gravity);for(let $ of this.nodes)$.updatePhysics(this.alpha);for(let $ of this.edges)$.updatePath()}applyRepulsionForce(J,K,Z){let $=K.position.x-J.position.x,V=K.position.y-J.position.y,B=$*$+V*V;if(B===0)return;let W=Math.sqrt(B),z=Z/B,Q=$/W*z,j=V/W*z;J.applyForce(-Q,-j),K.applyForce(Q,j)}applyAttractionForce(J,K,Z){let $=K.position.x-J.position.x,V=K.position.y-J.position.y,B=Math.sqrt($*$+V*V);if(B===0)return;let W=B*Z,z=$/B*W,Q=V/B*W;J.applyForce(z,Q),K.applyForce(-z,-Q)}applyGravityForce(J,K,Z,$){let V=K-J.position.x,B=Z-J.position.y,W=V*$,z=B*$;J.applyForce(W,z)}applyHierarchicalLayout(){if(this.nodes.length===0)return;let J=this.assignLayers(),K=150,Z=100,$=-((J.length-1)*K)/2;for(let V of J){let B=-((V.length-1)*Z)/2;for(let W of V)W.position.x=B,W.position.y=$,W.fixed=!1,B+=Z;$+=K}for(let V of this.edges)V.updatePath();if(this.config.animate)this.animateToPositions(this.config.duration)}assignLayers(){let J=new Map,K=[];for(let B of this.nodes)J.set(B.id,0);for(let B of this.edges){let W=J.get(B.to)||0;J.set(B.to,W+1)}let Z=this.nodes.filter((B)=>J.get(B.id)===0),$=new Set;while(Z.length>0){let B=[...Z];K.push(B);let W=[];for(let z of B){$.add(z.id);for(let Q of this.edges)if(Q.from===z.id){let j=this.nodes.find((M)=>M.id===Q.to);if(j&&!$.has(j.id)&&!W.includes(j))W.push(j)}}Z.length=0,Z.push(...W)}let V=this.nodes.filter((B)=>!$.has(B.id));if(V.length>0)K.push(V);return K}applyCircularLayout(){if(this.nodes.length===0)return;let J=Math.max(200,this.nodes.length*20),K=2*Math.PI/this.nodes.length;this.nodes.forEach((Z,$)=>{let V=$*K;Z.position.x=J*Math.cos(V),Z.position.y=J*Math.sin(V),Z.fixed=!1});for(let Z of this.edges)Z.updatePath();if(this.config.animate)this.animateToPositions(this.config.duration)}applyGridLayout(){if(this.nodes.length===0)return;let J=Math.ceil(Math.sqrt(this.nodes.length)),K=150;this.nodes.forEach((Z,$)=>{let V=Math.floor($/J),B=$%J;Z.position.x=(B-J/2)*K,Z.position.y=(V-J/2)*K,Z.fixed=!1});for(let Z of this.edges)Z.updatePath();if(this.config.animate)this.animateToPositions(this.config.duration)}animateToPositions(J){let K=this.nodes.map((V)=>({...V.position})),Z=Date.now(),$=()=>{let V=Date.now()-Z,B=Math.min(V/J,1),W=this.easeInOutCubic(B);this.nodes.forEach((z,Q)=>{let j=K[Q];z.position.x=j.x+(z.position.x-j.x)*W,z.position.y=j.y+(z.position.y-j.y)*W,z.updatePosition()});for(let z of this.edges)z.updatePath();if(B<1)requestAnimationFrame($)};$()}easeInOutCubic(J){return J<0.5?4*J*J*J:1-Math.pow(-2*J+2,3)/2}centerGraph(){if(this.nodes.length===0)return;let J=1/0,K=-1/0,Z=1/0,$=-1/0;for(let W of this.nodes)J=Math.min(J,W.position.x),K=Math.max(K,W.position.x),Z=Math.min(Z,W.position.y),$=Math.max($,W.position.y);let V=(J+K)/2,B=(Z+$)/2;for(let W of this.nodes)W.position.x-=V,W.position.y-=B,W.updatePosition();for(let W of this.edges)W.updatePath()}fitToViewport(J,K){if(this.nodes.length===0)return 1;let Z=1/0,$=-1/0,V=1/0,B=-1/0;for(let U of this.nodes)Z=Math.min(Z,U.position.x-U.radius),$=Math.max($,U.position.x+U.radius),V=Math.min(V,U.position.y-U.radius),B=Math.max(B,U.position.y+U.radius);let W=$-Z,z=B-V,Q=this.config.padding,j=(J-2*Q)/W,M=(K-2*Q)/z;return Math.min(j,M,2)}}class _{svg;viewport;nodes=new Map;edges=new Map;isDragging=!1;isPanning=!1;draggedNode=null;dragStart={x:0,y:0};panStart={x:0,y:0};lastMousePos={x:0,y:0};onNodeClick=null;onNodeDrag=null;onViewportChange=null;constructor(J,K){this.svg=J,this.viewport=K,this.setupEventListeners()}setupEventListeners(){this.svg.addEventListener("mousedown",this.onMouseDown.bind(this)),this.svg.addEventListener("mousemove",this.onMouseMove.bind(this)),this.svg.addEventListener("mouseup",this.onMouseUp.bind(this)),this.svg.addEventListener("wheel",this.onWheel.bind(this),{passive:!1}),this.svg.addEventListener("mouseleave",this.onMouseLeave.bind(this)),this.svg.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),this.svg.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.svg.addEventListener("touchend",this.onTouchEnd.bind(this)),this.svg.addEventListener("contextmenu",(J)=>J.preventDefault())}setNodes(J){this.nodes=J}setEdges(J){this.edges=J}setViewport(J){this.viewport=J}on(J,K){switch(J){case"nodeClick":this.onNodeClick=K;break;case"nodeDrag":this.onNodeDrag=K;break;case"viewportChange":this.onViewportChange=K;break}}onMouseDown(J){let K=this.screenToWorld({x:J.clientX,y:J.clientY}),Z=this.getNodeAtPosition(K);if(Z){if(this.isDragging=!0,this.draggedNode=Z,this.dragStart={...K},Z.setDragging(!0),this.onNodeClick)this.onNodeClick({type:"click",node:Z,position:K,originalEvent:J})}else this.isPanning=!0,this.panStart={x:J.clientX-this.viewport.x,y:J.clientY-this.viewport.y};this.lastMousePos={x:J.clientX,y:J.clientY},J.preventDefault()}onMouseMove(J){let K=this.screenToWorld({x:J.clientX,y:J.clientY});if(this.isDragging&&this.draggedNode){if(this.draggedNode.position.x=K.x,this.draggedNode.position.y=K.y,this.draggedNode.updatePosition(),this.updateEdgesForNode(this.draggedNode),this.onNodeDrag)this.onNodeDrag({type:"drag",node:this.draggedNode,position:K,originalEvent:J})}else if(this.isPanning){if(this.viewport.x=J.clientX-this.panStart.x,this.viewport.y=J.clientY-this.panStart.y,this.updateSVGTransform(),this.onViewportChange)this.onViewportChange({type:"pan",viewport:this.viewport,originalEvent:J})}else{let Z=this.getNodeAtPosition(K);for(let $ of this.nodes.values())$.setHovered($===Z);this.svg.style.cursor=Z?"pointer":this.isPanning?"grabbing":"grab"}this.lastMousePos={x:J.clientX,y:J.clientY}}onMouseUp(J){if(this.draggedNode)this.draggedNode.setDragging(!1),this.draggedNode.fixed=!1,this.draggedNode=null;this.isDragging=!1,this.isPanning=!1,this.svg.style.cursor="grab"}onMouseLeave(J){this.onMouseUp(J);for(let K of this.nodes.values())K.setHovered(!1)}onWheel(J){J.preventDefault();let K={x:J.clientX,y:J.clientY},Z=this.screenToWorld(K),$=J.deltaY>0?0.9:1.1;this.viewport.scale=Math.max(0.1,Math.min(5,this.viewport.scale*$));let V=this.screenToWorld(K);if(this.viewport.x+=(V.x-Z.x)*this.viewport.scale,this.viewport.y+=(V.y-Z.y)*this.viewport.scale,this.updateSVGTransform(),this.onViewportChange)this.onViewportChange({type:"zoom",viewport:this.viewport,originalEvent:J})}onTouchStart(J){if(J.preventDefault(),J.touches.length===1){let K=J.touches[0],Z=new MouseEvent("mousedown",{clientX:K.clientX,clientY:K.clientY});this.onMouseDown(Z)}else if(J.touches.length===2){this.isPanning=!0;let K=this.getTouchCenter(J.touches);this.panStart={x:K.x-this.viewport.x,y:K.y-this.viewport.y}}}onTouchMove(J){if(J.preventDefault(),J.touches.length===1&&(this.isDragging||this.isPanning)){let K=J.touches[0],Z=new MouseEvent("mousemove",{clientX:K.clientX,clientY:K.clientY});this.onMouseMove(Z)}else if(J.touches.length===2){let K=this.getTouchCenter(J.touches);if(this.isPanning)this.viewport.x=K.x-this.panStart.x,this.viewport.y=K.y-this.panStart.y,this.updateSVGTransform()}}onTouchEnd(J){if(J.touches.length===0)this.onMouseUp(new MouseEvent("mouseup"))}getTouchCenter(J){let K=0,Z=0;for(let $=0;$<J.length;$++)K+=J[$].clientX,Z+=J[$].clientY;return{x:K/J.length,y:Z/J.length}}screenToWorld(J){let K=this.svg.getBoundingClientRect();return{x:(J.x-K.left-this.viewport.x-K.width/2)/this.viewport.scale,y:(J.y-K.top-this.viewport.y-K.height/2)/this.viewport.scale}}worldToScreen(J){let K=this.svg.getBoundingClientRect();return{x:J.x*this.viewport.scale+this.viewport.x+K.width/2,y:J.y*this.viewport.scale+this.viewport.y+K.height/2}}getNodeAtPosition(J){let K=Array.from(this.nodes.values());for(let Z=K.length-1;Z>=0;Z--)if(K[Z].containsPoint(J))return K[Z];return null}updateEdgesForNode(J){for(let K of this.edges.values())if(K.from===J.id||K.to===J.id)K.updatePath()}updateSVGTransform(){let J=this.svg.querySelector(".graph-container");if(J)J.setAttribute("transform",`translate(${this.viewport.x}, ${this.viewport.y}) scale(${this.viewport.scale})`)}zoomIn(){if(this.viewport.scale=Math.min(5,this.viewport.scale*1.2),this.updateSVGTransform(),this.onViewportChange)this.onViewportChange({type:"zoom",viewport:this.viewport})}zoomOut(){if(this.viewport.scale=Math.max(0.1,this.viewport.scale/1.2),this.updateSVGTransform(),this.onViewportChange)this.onViewportChange({type:"zoom",viewport:this.viewport})}resetZoom(){if(this.viewport.scale=1,this.viewport.x=0,this.viewport.y=0,this.updateSVGTransform(),this.onViewportChange)this.onViewportChange({type:"zoom",viewport:this.viewport})}fitToView(){if(this.nodes.size===0)return;let J=1/0,K=-1/0,Z=1/0,$=-1/0;for(let M of this.nodes.values())J=Math.min(J,M.position.x-M.radius),K=Math.max(K,M.position.x+M.radius),Z=Math.min(Z,M.position.y-M.radius),$=Math.max($,M.position.y+M.radius);let V=this.svg.getBoundingClientRect(),B=K-J,W=$-Z,z=100,Q=(V.width-2*z)/B,j=(V.height-2*z)/W;if(this.viewport.scale=Math.min(Q,j,2),this.viewport.x=-(J+K)/2*this.viewport.scale,this.viewport.y=-(Z+$)/2*this.viewport.scale,this.updateSVGTransform(),this.onViewportChange)this.onViewportChange({type:"zoom",viewport:this.viewport})}destroy(){this.svg.removeEventListener("mousedown",this.onMouseDown.bind(this)),this.svg.removeEventListener("mousemove",this.onMouseMove.bind(this)),this.svg.removeEventListener("mouseup",this.onMouseUp.bind(this)),this.svg.removeEventListener("wheel",this.onWheel.bind(this)),this.svg.removeEventListener("mouseleave",this.onMouseLeave.bind(this)),this.svg.removeEventListener("touchstart",this.onTouchStart.bind(this)),this.svg.removeEventListener("touchmove",this.onTouchMove.bind(this)),this.svg.removeEventListener("touchend",this.onTouchEnd.bind(this))}}class C{container;canvas;ctx;width=200;height=150;visible=!0;nodes=[];edges=[];viewport;isDragging=!1;onViewportMove=null;constructor(J,K){this.container=J,this.viewport=K,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.className="minimap-canvas",this.canvas.style.cssText=`
            position: absolute;
            bottom: 20px;
            right: 20px;
            border: 2px solid ${H.border};
            border-radius: 4px;
            background: ${H.backgroundAlt};
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
        `;let Z=this.canvas.getContext("2d");if(!Z)throw Error("Canvas 2D context not available");this.ctx=Z,this.container.appendChild(this.canvas),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.onMouseUp.bind(this))}onMouseDown(J){this.isDragging=!0,this.updateViewportFromClick(J)}onMouseMove(J){if(this.isDragging)this.updateViewportFromClick(J)}onMouseUp(J){this.isDragging=!1}updateViewportFromClick(J){let K=this.canvas.getBoundingClientRect(),Z=J.clientX-K.left,$=J.clientY-K.top,V=this.calculateGraphBounds(),B=V.minX+Z/this.width*(V.maxX-V.minX),W=V.minY+$/this.height*(V.maxY-V.minY);if(this.viewport.x=-B*this.viewport.scale,this.viewport.y=-W*this.viewport.scale,this.onViewportMove)this.onViewportMove(this.viewport);this.render()}setNodes(J){this.nodes=J}setEdges(J){this.edges=J}setViewport(J){this.viewport=J}render(){if(!this.visible)return;if(this.ctx.clearRect(0,0,this.width,this.height),this.nodes.length===0)return;let J=this.calculateGraphBounds();this.ctx.strokeStyle=H.neutral,this.ctx.lineWidth=1;for(let K of this.edges){let Z=this.nodes.find((V)=>V.id===K.from),$=this.nodes.find((V)=>V.id===K.to);if(Z&&$){let V=this.worldToMinimapX(Z.position.x,J),B=this.worldToMinimapY(Z.position.y,J),W=this.worldToMinimapX($.position.x,J),z=this.worldToMinimapY($.position.y,J);this.ctx.beginPath(),this.ctx.moveTo(V,B),this.ctx.lineTo(W,z),this.ctx.stroke()}}for(let K of this.nodes){let Z=this.worldToMinimapX(K.position.x,J),$=this.worldToMinimapY(K.position.y,J),V=3;this.ctx.fillStyle=this.getStatusColor(K),this.ctx.beginPath(),this.ctx.arc(Z,$,3,0,2*Math.PI),this.ctx.fill()}this.drawViewportRect(J)}drawViewportRect(J){let K=this.viewport.width/this.viewport.scale,Z=this.viewport.height/this.viewport.scale,$=-this.viewport.x/this.viewport.scale,V=-this.viewport.y/this.viewport.scale,B=this.worldToMinimapX($-K/2,J),W=this.worldToMinimapY(V-Z/2,J),z=this.worldToMinimapX($+K/2,J),Q=this.worldToMinimapY(V+Z/2,J);this.ctx.strokeStyle=H.brand,this.ctx.lineWidth=2,this.ctx.strokeRect(B,W,z-B,Q-W)}calculateGraphBounds(){let J=1/0,K=-1/0,Z=1/0,$=-1/0;for(let B of this.nodes)J=Math.min(J,B.position.x),K=Math.max(K,B.position.x),Z=Math.min(Z,B.position.y),$=Math.max($,B.position.y);let V=50;return{minX:J-V,maxX:K+V,minY:Z-V,maxY:$+V}}worldToMinimapX(J,K){let Z=K.maxX-K.minX;return(J-K.minX)/Z*this.width}worldToMinimapY(J,K){let Z=K.maxY-K.minY;return(J-K.minY)/Z*this.height}getStatusColor(J){return H.brand}show(){this.visible=!0,this.canvas.style.display="block",this.render()}hide(){this.visible=!1,this.canvas.style.display="none"}toggle(){if(this.visible)this.hide();else this.show()}onViewportChange(J){this.onViewportMove=J}destroy(){if(this.canvas.parentNode)this.canvas.parentNode.removeChild(this.canvas)}}class R{nodes=[];edges=[];filteredNodeIds=new Set;highlightedNodeIds=new Set;onFilterChange=null;onHighlightChange=null;setNodes(J){this.nodes=J}setEdges(J){this.edges=J}search(J){let K=new Set;if(!J||J.trim()===""){if(this.highlightedNodeIds.clear(),this.onHighlightChange)this.onHighlightChange(this.highlightedNodeIds);return K}let Z=J.toLowerCase();for(let $ of this.nodes)if($.name.toLowerCase().includes(Z)||$.description.toLowerCase().includes(Z)||$.type.toLowerCase().includes(Z)||$.model.toLowerCase().includes(Z))K.add($.id);if(this.highlightedNodeIds=K,this.onHighlightChange)this.onHighlightChange(this.highlightedNodeIds);return K}searchByType(J){let K=new Set;for(let Z of this.nodes)if(Z.type===J)K.add(Z.id);return K}searchByStatus(J){let K=new Set;for(let Z of this.nodes)if(Z.status===J)K.add(Z.id);return K}applyFilter(J){let K=new Set;for(let Z of this.nodes)if(this.matchesCriteria(Z,J))K.add(Z.id);if(this.filteredNodeIds=K,this.onFilterChange)this.onFilterChange(this.filteredNodeIds);return K}matchesCriteria(J,K){if(K.searchText){let Z=K.searchText.toLowerCase();if(!(J.name.toLowerCase().includes(Z)||J.description.toLowerCase().includes(Z)||J.type.toLowerCase().includes(Z)||J.model.toLowerCase().includes(Z)))return!1}if(K.nodeTypes&&K.nodeTypes.length>0){if(!K.nodeTypes.includes(J.type))return!1}if(K.statuses&&K.statuses.length>0){if(!K.statuses.includes(J.status))return!1}if(K.minLatency!==void 0){if(J.metrics.avgLatency<K.minLatency)return!1}if(K.maxLatency!==void 0){if(J.metrics.avgLatency>K.maxLatency)return!1}if(K.minSuccessRate!==void 0){if(J.metrics.successRate<K.minSuccessRate)return!1}return!0}clearFilter(){if(this.filteredNodeIds.clear(),this.onFilterChange)this.onFilterChange(this.filteredNodeIds)}findPath(J,K){let Z=[J],$=new Set([J]),V=new Map;while(Z.length>0){let B=Z.shift();if(B===K){let W=[],z=K;while(z!==void 0)W.unshift(z),z=V.get(z);return W}for(let W of this.edges)if(W.from===B&&!$.has(W.to))$.add(W.to),V.set(W.to,B),Z.push(W.to)}return[]}highlightPath(J){if(this.highlightedNodeIds=new Set(J),this.onHighlightChange)this.onHighlightChange(this.highlightedNodeIds)}getNeighbors(J,K=1){let Z=new Set,$=[{id:J,depth:0}],V=new Set([J]);while($.length>0){let B=$.shift();if(B.depth>=K)continue;for(let W of this.edges){if(W.from===B.id&&!V.has(W.to))Z.add(W.to),V.add(W.to),$.push({id:W.to,depth:B.depth+1});if(W.to===B.id&&!V.has(W.from))Z.add(W.from),V.add(W.from),$.push({id:W.from,depth:B.depth+1})}}return Z}focusOnNode(J,K=!0){let Z=new Set([J]);if(K){let $=this.getNeighbors(J,1);for(let V of $)Z.add(V)}if(this.filteredNodeIds=Z,this.onFilterChange)this.onFilterChange(this.filteredNodeIds);return Z}getNodesByType(){let J=new Map;for(let K of this.nodes)J.set(K.type,(J.get(K.type)||0)+1);return J}getNodesByStatus(){let J=new Map;for(let K of this.nodes)J.set(K.status,(J.get(K.status)||0)+1);return J}getAverageMetrics(){if(this.nodes.length===0)return{avgLatency:0,avgSuccessRate:0,totalRequests:0};let J=0,K=0,Z=0;for(let $ of this.nodes)J+=$.metrics.avgLatency,K+=$.metrics.successRate,Z+=$.metrics.totalRequests;return{avgLatency:J/this.nodes.length,avgSuccessRate:K/this.nodes.length,totalRequests:Z}}onFilter(J){this.onFilterChange=J}onHighlight(J){this.onHighlightChange=J}getFilteredNodes(){return new Set(this.filteredNodeIds)}getHighlightedNodes(){return new Set(this.highlightedNodeIds)}}class X{undoStack=[];redoStack=[];maxHistorySize=50;onHistoryChange=null;recordNodeAdd(J,K,Z){let $={type:"node_add",execute:K,undo:Z,data:{node:J}};this.executeAndRecord($)}recordNodeRemove(J,K,Z){let $={type:"node_remove",execute:K,undo:Z,data:{node:J}};this.executeAndRecord($)}recordNodeMove(J,K,Z,$){let V={type:"node_move",execute:()=>$(Z),undo:()=>$(K),data:{nodeId:J,oldPos:K,newPos:Z}};this.executeAndRecord(V)}recordEdgeAdd(J,K,Z){let $={type:"edge_add",execute:K,undo:Z,data:{edge:J}};this.executeAndRecord($)}recordEdgeRemove(J,K,Z){let $={type:"edge_remove",execute:K,undo:Z,data:{edge:J}};this.executeAndRecord($)}recordStatusChange(J,K,Z,$){let V={type:"status_change",execute:()=>$(Z),undo:()=>$(K),data:{nodeId:J,oldStatus:K,newStatus:Z}};this.executeAndRecord(V)}recordBatchOperation(J,K){let Z={type:"batch",execute:()=>J.forEach(($)=>$()),undo:()=>K.reverse().forEach(($)=>$()),data:{count:J.length}};this.executeAndRecord(Z)}executeAndRecord(J){if(J.execute(),this.undoStack.push(J),this.redoStack=[],this.undoStack.length>this.maxHistorySize)this.undoStack.shift();this.notifyChange()}undo(){if(this.undoStack.length===0)return!1;let J=this.undoStack.pop();return J.undo(),this.redoStack.push(J),this.notifyChange(),!0}redo(){if(this.redoStack.length===0)return!1;let J=this.redoStack.pop();return J.execute(),this.undoStack.push(J),this.notifyChange(),!0}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.notifyChange()}getUndoStack(){return[...this.undoStack]}getRedoStack(){return[...this.redoStack]}getUndoStackSize(){return this.undoStack.length}getRedoStackSize(){return this.redoStack.length}goToState(J){while(this.undoStack.length>J)if(!this.undo())break;while(this.undoStack.length<J)if(!this.redo())break}getStateCount(){return this.undoStack.length+this.redoStack.length+1}onChange(J){this.onHistoryChange=J}notifyChange(){if(this.onHistoryChange)this.onHistoryChange()}}class Y{svg;selectedNodes=new Set;lassoActive=!1;lassoPath=null;lassoPoints=[];rubberBandActive=!1;rubberBandRect=null;rubberBandStart={x:0,y:0};selectionMode="single";onSelectionChange=null;constructor(J){this.svg=J,this.createSelectionElements()}createSelectionElements(){this.lassoPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.lassoPath.setAttribute("class","lasso-path"),this.lassoPath.setAttribute("fill","rgba(0, 112, 242, 0.1)"),this.lassoPath.setAttribute("stroke","#0070f2"),this.lassoPath.setAttribute("stroke-width","2"),this.lassoPath.setAttribute("stroke-dasharray","5,5"),this.lassoPath.setAttribute("visibility","hidden"),this.svg.appendChild(this.lassoPath),this.rubberBandRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rubberBandRect.setAttribute("class","rubber-band"),this.rubberBandRect.setAttribute("fill","rgba(0, 112, 242, 0.1)"),this.rubberBandRect.setAttribute("stroke","#0070f2"),this.rubberBandRect.setAttribute("stroke-width","2"),this.rubberBandRect.setAttribute("stroke-dasharray","5,5"),this.rubberBandRect.setAttribute("visibility","hidden"),this.svg.appendChild(this.rubberBandRect)}setMode(J){switch(this.selectionMode=J,J){case"lasso":this.svg.style.cursor="crosshair";break;case"rubberband":this.svg.style.cursor="crosshair";break;default:this.svg.style.cursor="grab"}}getMode(){return this.selectionMode}startLasso(J){if(this.lassoActive=!0,this.lassoPoints=[J],this.lassoPath)this.lassoPath.setAttribute("visibility","visible")}updateLasso(J){if(!this.lassoActive||!this.lassoPath)return;if(this.lassoPoints.push(J),this.lassoPoints.length>1){let K=`M ${this.lassoPoints[0].x} ${this.lassoPoints[0].y}`;for(let Z=1;Z<this.lassoPoints.length;Z++)K+=` L ${this.lassoPoints[Z].x} ${this.lassoPoints[Z].y}`;this.lassoPath.setAttribute("d",K)}}endLasso(J){if(!this.lassoActive)return;if(this.lassoActive=!1,this.lassoPath&&this.lassoPoints.length>2){let K=this.lassoPath.getAttribute("d")||"";K+=" Z",this.lassoPath.setAttribute("d",K);let Z=this.getNodesInLasso(J);this.setSelection(Z)}if(this.lassoPath)this.lassoPath.setAttribute("visibility","hidden");this.lassoPoints=[]}getNodesInLasso(J){let K=new Set;for(let Z of J)if(this.isPointInPolygon(Z.position,this.lassoPoints))K.add(Z.id);return K}isPointInPolygon(J,K){let Z=!1;for(let $=0,V=K.length-1;$<K.length;V=$++){let B=K[$].x,W=K[$].y,z=K[V].x,Q=K[V].y;if(W>J.y!==Q>J.y&&J.x<(z-B)*(J.y-W)/(Q-W)+B)Z=!Z}return Z}startRubberBand(J){if(this.rubberBandActive=!0,this.rubberBandStart=J,this.rubberBandRect)this.rubberBandRect.setAttribute("visibility","visible"),this.rubberBandRect.setAttribute("x",J.x.toString()),this.rubberBandRect.setAttribute("y",J.y.toString()),this.rubberBandRect.setAttribute("width","0"),this.rubberBandRect.setAttribute("height","0")}updateRubberBand(J){if(!this.rubberBandActive||!this.rubberBandRect)return;let K=Math.min(this.rubberBandStart.x,J.x),Z=Math.min(this.rubberBandStart.y,J.y),$=Math.abs(J.x-this.rubberBandStart.x),V=Math.abs(J.y-this.rubberBandStart.y);this.rubberBandRect.setAttribute("x",K.toString()),this.rubberBandRect.setAttribute("y",Z.toString()),this.rubberBandRect.setAttribute("width",$.toString()),this.rubberBandRect.setAttribute("height",V.toString())}endRubberBand(J,K){if(!this.rubberBandActive)return;this.rubberBandActive=!1;let Z=Math.min(this.rubberBandStart.x,K.x),$=Math.min(this.rubberBandStart.y,K.y),V=Math.max(this.rubberBandStart.x,K.x),B=Math.max(this.rubberBandStart.y,K.y),W=new Set;for(let z of J)if(z.position.x>=Z&&z.position.x<=V&&z.position.y>=$&&z.position.y<=B)W.add(z.id);if(this.setSelection(W),this.rubberBandRect)this.rubberBandRect.setAttribute("visibility","hidden")}setSelection(J){if(this.selectedNodes=new Set(J),this.onSelectionChange)this.onSelectionChange(this.selectedNodes)}addToSelection(J){if(this.selectedNodes.add(J),this.onSelectionChange)this.onSelectionChange(this.selectedNodes)}removeFromSelection(J){if(this.selectedNodes.delete(J),this.onSelectionChange)this.onSelectionChange(this.selectedNodes)}toggleSelection(J){if(this.selectedNodes.has(J))this.removeFromSelection(J);else this.addToSelection(J)}clearSelection(){if(this.selectedNodes.clear(),this.onSelectionChange)this.onSelectionChange(this.selectedNodes)}getSelection(){return new Set(this.selectedNodes)}selectAll(J){if(this.selectedNodes=new Set(J.map((K)=>K.id)),this.onSelectionChange)this.onSelectionChange(this.selectedNodes)}invertSelection(J){let K=new Set(J.map(($)=>$.id)),Z=new Set;for(let $ of K)if(!this.selectedNodes.has($))Z.add($);this.setSelection(Z)}onSelection(J){this.onSelectionChange=J}destroy(){if(this.lassoPath&&this.lassoPath.parentNode)this.lassoPath.parentNode.removeChild(this.lassoPath);if(this.rubberBandRect&&this.rubberBandRect.parentNode)this.rubberBandRect.parentNode.removeChild(this.rubberBandRect);this.selectedNodes.clear()}}class P{container;svg;defsElement;graphContainer;state;layoutEngine;interactionHandler;minimap=null;searchFilter;historyManager;multiSelectHandler;ws=null;eventHandlers=new Map;constructor(J){if(typeof J==="string"){let K=document.querySelector(J);if(!K)throw Error(`Container not found: ${J}`);this.container=K}else this.container=J;this.state={nodes:new Map,edges:new Map,groups:new Map,selectedNodeId:null,hoveredNodeId:null,viewport:{...N},layout:"force-directed"},this.svg=this.createSVG(),this.defsElement=this.createDefs(),this.graphContainer=this.createGraphContainer(),this.svg.appendChild(this.defsElement),this.svg.appendChild(this.graphContainer),this.container.appendChild(this.svg),this.layoutEngine=new D,this.interactionHandler=new _(this.svg,this.state.viewport),this.setupEventHandlers(),this.searchFilter=new R,this.historyManager=new X,this.multiSelectHandler=new Y(this.svg),this.setupSubComponentCallbacks(),this.updateViewportSize(),window.addEventListener("resize",()=>this.updateViewportSize())}createSVG(){let J=document.createElementNS("http://www.w3.org/2000/svg","svg");return J.setAttribute("class","network-graph"),J.setAttribute("width","100%"),J.setAttribute("height","100%"),J.style.background=H.background,J.style.cursor="grab",J}createDefs(){let J=document.createElementNS("http://www.w3.org/2000/svg","defs"),K=document.createElementNS("http://www.w3.org/2000/svg","filter");K.setAttribute("id","nodeShadow"),K.setAttribute("x","-50%"),K.setAttribute("y","-50%"),K.setAttribute("width","200%"),K.setAttribute("height","200%");let Z=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");Z.setAttribute("in","SourceAlpha"),Z.setAttribute("stdDeviation","3");let $=document.createElementNS("http://www.w3.org/2000/svg","feOffset");$.setAttribute("dx","0"),$.setAttribute("dy","2"),$.setAttribute("result","offsetblur");let V=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),B=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");B.setAttribute("type","linear"),B.setAttribute("slope","0.3"),V.appendChild(B);let W=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),z=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode"),Q=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");return Q.setAttribute("in","SourceGraphic"),W.appendChild(z),W.appendChild(Q),K.appendChild(Z),K.appendChild($),K.appendChild(V),K.appendChild(W),J.appendChild(K),J}createGraphContainer(){let J=document.createElementNS("http://www.w3.org/2000/svg","g");return J.setAttribute("class","graph-container"),J}setupEventHandlers(){this.interactionHandler.on("nodeClick",(J)=>{this.selectNode(J.node.id),this.emit("nodeClick",J)}),this.interactionHandler.on("nodeDrag",(J)=>{this.emit("nodeDrag",J)}),this.interactionHandler.on("viewportChange",(J)=>{if(this.minimap)this.minimap.setViewport(J.viewport),this.minimap.render();this.emit("viewportChange",J)})}setupSubComponentCallbacks(){this.historyManager.onChange(()=>{this.emit("historyChange",{canUndo:this.historyManager.canUndo(),canRedo:this.historyManager.canRedo()})}),this.multiSelectHandler.onSelection((J)=>{this.emit("multiSelectionChange",{selectedIds:J})}),this.searchFilter.onFilter((J)=>{this.emit("filterChange",{filteredIds:J})}),this.searchFilter.onHighlight((J)=>{this.emit("highlightChange",{highlightedIds:J})})}addNode(J){let K=new k(J);this.state.nodes.set(K.id,K),this.graphContainer.appendChild(K.element),this.interactionHandler.setNodes(this.state.nodes),this.updateSubComponentsData(),this.emit("nodeAdded",{node:K})}addEdge(J){let K=new G(J);this.state.edges.set(K.id,K);let Z=this.graphContainer.querySelector(".graph-node");if(Z)this.graphContainer.insertBefore(K.element,Z);else this.graphContainer.appendChild(K.element);let $=this.state.nodes.get(K.from),V=this.state.nodes.get(K.to);if($&&V)K.setNodes($,V);this.interactionHandler.setEdges(this.state.edges),this.updateSubComponentsData(),this.emit("edgeAdded",{edge:K})}removeNode(J){let K=this.state.nodes.get(J);if(!K)return;for(let[Z,$]of this.state.edges)if($.from===J||$.to===J)this.removeEdge(Z);K.destroy(),this.state.nodes.delete(J),this.updateSubComponentsData(),this.emit("nodeRemoved",{nodeId:J})}removeEdge(J){let K=this.state.edges.get(J);if(!K)return;K.destroy(),this.state.edges.delete(J),this.updateSubComponentsData(),this.emit("edgeRemoved",{edgeId:J})}clear(){for(let J of this.state.nodes.values())J.destroy();this.state.nodes.clear();for(let J of this.state.edges.values())J.destroy();this.state.edges.clear(),this.updateSubComponentsData(),this.emit("cleared",{})}updateSubComponentsData(){let J=Array.from(this.state.nodes.values()),K=Array.from(this.state.edges.values());if(this.searchFilter.setNodes(J),this.searchFilter.setEdges(K),this.minimap)this.minimap.setNodes(J),this.minimap.setEdges(K),this.minimap.render()}setLayout(J){this.state.layout=J,this.layoutEngine.setConfig({type:J}),this.applyLayout()}applyLayout(){this.layoutEngine.setNodes(Array.from(this.state.nodes.values())),this.layoutEngine.setEdges(Array.from(this.state.edges.values())),this.layoutEngine.start(),this.emit("layoutApplied",{layout:this.state.layout})}centerGraph(){this.layoutEngine.setNodes(Array.from(this.state.nodes.values())),this.layoutEngine.setEdges(Array.from(this.state.edges.values())),this.layoutEngine.centerGraph()}fitToView(){this.interactionHandler.fitToView()}updateNodeStatus(J,K){let Z=this.state.nodes.get(J);if(Z)Z.setStatus(K),this.emit("nodeStatusChanged",{nodeId:J,status:K})}selectNode(J){if(this.state.selectedNodeId){let K=this.state.nodes.get(this.state.selectedNodeId);if(K)K.setSelected(!1)}if(this.state.selectedNodeId=J,J){let K=this.state.nodes.get(J);if(K)K.setSelected(!0)}this.emit("selectionChanged",{nodeId:J})}getNode(J){return this.state.nodes.get(J)}getSelectedNode(){return this.state.selectedNodeId?this.state.nodes.get(this.state.selectedNodeId)||null:null}updateEdgeStatus(J,K){let Z=this.state.edges.get(J);if(Z)Z.setStatus(K),this.emit("edgeStatusChanged",{edgeId:J,status:K})}getEdge(J){return this.state.edges.get(J)}enableMinimap(){if(this.minimap)return;this.minimap=new C(this.container,this.state.viewport),this.minimap.setNodes(Array.from(this.state.nodes.values())),this.minimap.setEdges(Array.from(this.state.edges.values())),this.minimap.onViewportChange((J)=>{this.interactionHandler.setViewport(J),this.emit("viewportChange",{viewport:J})}),this.minimap.show(),this.minimap.render()}disableMinimap(){if(!this.minimap)return;this.minimap.destroy(),this.minimap=null}search(J){return this.searchFilter.search(J)}filter(J){this.searchFilter.applyFilter(J)}clearFilter(){this.searchFilter.clearFilter()}undo(){this.historyManager.undo()}redo(){this.historyManager.redo()}canUndo(){return this.historyManager.canUndo()}canRedo(){return this.historyManager.canRedo()}getMultiSelectHandler(){return this.multiSelectHandler}getHistoryManager(){return this.historyManager}getSearchFilter(){return this.searchFilter}zoomIn(){this.interactionHandler.zoomIn()}zoomOut(){this.interactionHandler.zoomOut()}resetZoom(){this.interactionHandler.resetZoom()}getViewport(){return{...this.state.viewport}}async loadFromAPI(J){try{let K=await fetch(J);if(!K.ok)throw Error(`HTTP ${K.status}`);let Z=await K.json();this.loadData(Z),this.emit("dataLoaded",{source:J})}catch(K){console.error("Failed to load from API:",K),this.emit("error",{error:K,source:"loadFromAPI"})}}loadData(J){if(this.clear(),J.agents)for(let K of J.agents)this.addNode({id:K.id,name:K.name,description:K.description,type:K.type,status:this.mapStatus(K.status),model:K.model_id,metrics:{totalRequests:K.total_requests||0,avgLatency:K.avg_latency||0,successRate:K.success_rate||0}});if(J.agents){for(let K of J.agents)if(K.next_agents)for(let Z of K.next_agents){let $=`${K.id}-${Z}`;this.addEdge({id:$,from:K.id,to:Z,status:"Active"})}}setTimeout(()=>{this.applyLayout(),setTimeout(()=>this.fitToView(),1000)},100)}mapStatus(J){return{healthy:"Success",warning:"Warning",error:"Error",running:"Running",busy:"Warning"}[J?.toLowerCase()]||"None"}connectWebSocket(J){if(this.ws)this.ws.close();this.ws=new WebSocket(J),this.ws.onopen=()=>{console.log("✅ NetworkGraph WebSocket connected"),this.emit("wsConnected",{})},this.ws.onmessage=(K)=>{try{let Z=JSON.parse(K.data);this.handleWSUpdate(Z)}catch(Z){console.error("Failed to parse WS message:",Z)}},this.ws.onerror=(K)=>{console.error("WebSocket error:",K),this.emit("wsError",{error:K})},this.ws.onclose=()=>{console.log("WebSocket closed"),this.emit("wsDisconnected",{})}}handleWSUpdate(J){if(J.type==="agent_status")this.updateNodeStatus(J.agent_id,this.mapStatus(J.status));else if(J.type==="workflow_step"){let K=`${J.from}-${J.to}`,Z=this.state.edges.get(K);if(Z)Z.flash()}this.emit("wsUpdate",J)}disconnectWebSocket(){if(this.ws)this.ws.close(),this.ws=null}on(J,K){if(!this.eventHandlers.has(J))this.eventHandlers.set(J,[]);this.eventHandlers.get(J).push(K)}off(J,K){if(!K)this.eventHandlers.delete(J);else{let Z=this.eventHandlers.get(J);if(Z){let $=Z.indexOf(K);if($!==-1)Z.splice($,1)}}}emit(J,K){let Z=this.eventHandlers.get(J);if(Z)for(let $ of Z)$(K)}exportData(){return{nodes:Array.from(this.state.nodes.values()).map((J)=>J.toJSON()),edges:Array.from(this.state.edges.values()).map((J)=>J.toJSON()),viewport:this.state.viewport,layout:this.state.layout}}exportImage(){let J=new XMLSerializer().serializeToString(this.svg);return"data:image/svg+xml;base64,"+btoa(J)}updateViewportSize(){let J=this.container.getBoundingClientRect();this.state.viewport.width=J.width,this.state.viewport.height=J.height,this.interactionHandler.setViewport(this.state.viewport)}getStats(){return{nodeCount:this.state.nodes.size,edgeCount:this.state.edges.size,viewport:this.state.viewport,layout:this.state.layout}}destroy(){if(this.disconnectWebSocket(),this.clear(),this.interactionHandler.destroy(),this.layoutEngine.stop(),this.minimap)this.minimap.destroy(),this.minimap=null;if(this.multiSelectHandler.destroy(),this.svg.parentNode)this.svg.parentNode.removeChild(this.svg);this.eventHandlers.clear()}}if(typeof window<"u")window.NetworkGraph=P;export{P as NetworkGraph};
