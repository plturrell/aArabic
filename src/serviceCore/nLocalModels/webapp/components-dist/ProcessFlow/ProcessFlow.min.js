var u={["One"]:{scale:1.2,nodeWidth:200,nodeHeight:100,showHeader:!0,showStatus:!0,showAttr1:!0,showAttr2:!0},["Two"]:{scale:1,nodeWidth:160,nodeHeight:80,showHeader:!0,showStatus:!0,showAttr1:!0,showAttr2:!1},["Three"]:{scale:0.8,nodeWidth:120,nodeHeight:60,showHeader:!0,showStatus:!0,showAttr1:!1,showAttr2:!1},["Four"]:{scale:0.6,nodeWidth:60,nodeHeight:40,showHeader:!1,showStatus:!0,showAttr1:!1,showAttr2:!1}},Z={positive:{background:"#107e3e",border:"#0a6534",text:"#ffffff"},negative:{background:"#bb0000",border:"#a20000",text:"#ffffff"},critical:{background:"#e9730c",border:"#c9630a",text:"#ffffff"},planned:{background:"#ededed",border:"#d9d9d9",text:"#32363a"},plannedNegative:{background:"#ededed",border:"#bb0000",text:"#32363a"},neutral:{background:"#0a6ed1",border:"#0854a0",text:"#ffffff"},connection:{normal:"#6a6d70",highlighted:"#0a6ed1",dimmed:"#d9d9d9"},lane:{default:"#ffffff",alternate:"#fafafa"},text:{primary:"#32363a",secondary:"#6a6d70",light:"#89919a"},border:"#d9d9d9",hover:"rgba(10, 110, 209, 0.1)",selected:"rgba(10, 110, 209, 0.2)",focus:"#0a6ed1"},Q={node:{width:160,height:80,cornerRadius:4,borderWidth:2,padding:12,iconSize:24,titleFontSize:14,textFontSize:12},spacing:{horizontal:80,vertical:100,laneHeader:120,topMargin:20,bottomMargin:20,leftMargin:20,rightMargin:20},connection:{strokeWidth:2,arrowSize:8,cornerRadius:8,dashArray:"5,5"},zoom:{one:{scale:1,showTexts:!0,showIcons:!0},two:{scale:0.75,showTexts:!0,showIcons:!0},three:{scale:0.5,showTexts:!1,showIcons:!0},four:{scale:0.25,showTexts:!1,showIcons:!1}},animation:{duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)"}},U={showLabels:!0,scrollable:!0,foldedCorners:!0,wheelZoomable:!0,optimizeDisplay:!0,zoomLevel:"One"};class y{id;lane;title;state;texts;children;position;foldedCorners;isAggregated;aggregatedCount;aggregatedItems;isExpanded=!1;element;background;borderPath;foldTriangle=null;titleText;stateText;detailTexts=[];icon=null;statusIcon=null;stackElements=[];counterBadge=null;displayState="Regular";currentZoomLevel="Two";currentZoomConfig=u["Two"];x=0;y=0;constructor(j){this.id=j.id,this.lane=j.lane,this.title=j.title,this.state=j.state,this.texts=j.texts||[],this.children=j.children||[],this.position=j.position||0,this.foldedCorners=j.foldedCorners!==void 0?j.foldedCorners:!0,this.isAggregated=j.isAggregated||!1,this.aggregatedCount=j.aggregatedCount||0,this.aggregatedItems=j.aggregatedItems||[],this.element=this.createElement()}createElement(){let j=document.createElementNS("http://www.w3.org/2000/svg","g");if(j.setAttribute("class","process-flow-node"),j.setAttribute("data-node-id",this.id),j.setAttribute("data-state",this.state),this.isAggregated)j.classList.add("aggregated-node");if(this.foldedCorners)j.classList.add("folded-corner");let q=Q.node;if(this.isAggregated)this.renderStack(j);if(this.background=this.foldedCorners?this.createFoldedCornerPath():this.createRegularPath(),j.appendChild(this.background),this.borderPath=this.createBorderPath(),j.appendChild(this.borderPath),this.foldedCorners)this.foldTriangle=this.renderFoldedCorner(),j.appendChild(this.foldTriangle);if(this.needsIcon())this.icon=this.createIcon(),j.appendChild(this.icon);this.titleText=this.createTitle(),j.appendChild(this.titleText),this.stateText=this.createStateText(),j.appendChild(this.stateText);for(let J=0;J<this.texts.length;J++){let K=this.createDetailText(this.texts[J],J);this.detailTexts.push(K),j.appendChild(K)}if(this.statusIcon=this.createStatusIcon(),j.appendChild(this.statusIcon),this.statusIcon.style.display="none",this.isAggregated&&this.aggregatedCount>1)this.renderCounter(j);return j.style.cursor="pointer",j.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",j}createStatusIcon(){let j=document.createElementNS("http://www.w3.org/2000/svg","text");return j.setAttribute("class","node-status-icon"),j.setAttribute("x","30"),j.setAttribute("y","28"),j.setAttribute("font-size","24"),j.setAttribute("text-anchor","middle"),j.setAttribute("dominant-baseline","middle"),j.setAttribute("fill",this.getStateColors().text),j.textContent=this.getIconForState(),j}createFoldedCornerPath(){let j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("class","node-background");let q=Q.node.width,J=Q.node.height,K=Q.node.cornerRadius,$=12,B=`
            M ${K} 0
            L ${q-$} 0
            L ${q} ${$}
            L ${q} ${J-K}
            Q ${q} ${J}, ${q-K} ${J}
            L ${K} ${J}
            Q 0 ${J}, 0 ${J-K}
            L 0 ${K}
            Q 0 0, ${K} 0
            Z
        `.trim().replace(/\s+/g," ");return j.setAttribute("d",B),j.setAttribute("fill",this.getStateColors().background),j.style.transition="fill 0.3s ease",j}createRegularPath(){let j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("class","node-background");let q=Q.node.width,J=Q.node.height,K=Q.node.cornerRadius,$=`
            M ${K} 0
            L ${q-K} 0
            Q ${q} 0, ${q} ${K}
            L ${q} ${J-K}
            Q ${q} ${J}, ${q-K} ${J}
            L ${K} ${J}
            Q 0 ${J}, 0 ${J-K}
            L 0 ${K}
            Q 0 0, ${K} 0
            Z
        `.trim().replace(/\s+/g," ");return j.setAttribute("d",$),j.setAttribute("fill",this.getStateColors().background),j.style.transition="fill 0.3s ease",j}renderFoldedCorner(){let j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("class","node-fold-triangle");let q=Q.node.width,J=12,K=`
            M ${q-J} 0
            L ${q-J} ${J}
            L ${q} ${J}
            Z
        `.trim().replace(/\s+/g," ");j.setAttribute("d",K);let $=this.getStateColors();return j.setAttribute("fill",this.getLighterShade($.background)),j.setAttribute("stroke",$.border),j.setAttribute("stroke-width","1"),j.style.transition="fill 0.3s ease",j.style.filter="drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.15))",j}getLighterShade(j){let q=j.replace("#",""),J=parseInt(q.substring(0,2),16),K=parseInt(q.substring(2,4),16),$=parseInt(q.substring(4,6),16),B=0.3,M=Math.min(255,Math.round(J+(255-J)*0.3)),V=Math.min(255,Math.round(K+(255-K)*0.3)),G=Math.min(255,Math.round($+(255-$)*0.3)),H=(k)=>{let z=k.toString(16);return z.length===1?"0"+z:z};return"#"+H(M)+H(V)+H(G)}createBorderPath(){let j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("class","node-border");let q=Q.node.width,J=Q.node.height,K=Q.node.cornerRadius,$=12,B;if(this.foldedCorners)B=`
                M ${K} 0
                L ${q-$} 0
                L ${q} ${$}
                L ${q} ${J-K}
                Q ${q} ${J}, ${q-K} ${J}
                L ${K} ${J}
                Q 0 ${J}, 0 ${J-K}
                L 0 ${K}
                Q 0 0, ${K} 0
                Z
            `.trim().replace(/\s+/g," ");else B=`
                M ${K} 0
                L ${q-K} 0
                Q ${q} 0, ${q} ${K}
                L ${q} ${J-K}
                Q ${q} ${J}, ${q-K} ${J}
                L ${K} ${J}
                Q 0 ${J}, 0 ${J-K}
                L 0 ${K}
                Q 0 0, ${K} 0
                Z
            `.trim().replace(/\s+/g," ");return j.setAttribute("d",B),j.setAttribute("fill","none"),j.setAttribute("stroke",this.getStateColors().border),j.setAttribute("stroke-width",Q.node.borderWidth.toString()),j.style.transition="stroke 0.3s ease",j}createIcon(){let j=document.createElementNS("http://www.w3.org/2000/svg","text");return j.setAttribute("class","node-icon"),j.setAttribute("x",Q.node.padding.toString()),j.setAttribute("y",(Q.node.padding+18).toString()),j.setAttribute("font-size",Q.node.iconSize.toString()),j.setAttribute("fill",this.getStateColors().text),j.textContent=this.getIconForState(),j}createTitle(){let j=document.createElementNS("http://www.w3.org/2000/svg","text");j.setAttribute("class","node-title");let q=this.icon?40:Q.node.padding;return j.setAttribute("x",q.toString()),j.setAttribute("y",(Q.node.padding+16).toString()),j.setAttribute("font-size",Q.node.titleFontSize.toString()),j.setAttribute("font-weight","bold"),j.setAttribute("fill",this.getStateColors().text),j.textContent=this.truncateText(this.title,18),j}createStateText(){let j=document.createElementNS("http://www.w3.org/2000/svg","text");return j.setAttribute("class","node-state-text"),j.setAttribute("x",Q.node.padding.toString()),j.setAttribute("y",(Q.node.padding+36).toString()),j.setAttribute("font-size",Q.node.textFontSize.toString()),j.setAttribute("fill",this.getStateColors().text),j.setAttribute("opacity","0.9"),j.textContent=this.getStateLabel(),j}createDetailText(j,q){let J=document.createElementNS("http://www.w3.org/2000/svg","text");return J.setAttribute("class","node-detail-text"),J.setAttribute("x",Q.node.padding.toString()),J.setAttribute("y",(Q.node.padding+52+q*14).toString()),J.setAttribute("font-size",(Q.node.textFontSize-1).toString()),J.setAttribute("fill",this.getStateColors().text),J.setAttribute("opacity","0.8"),J.textContent=this.truncateText(j,22),J}renderStack(j){let q=Q.node.width,J=Q.node.height,K=Q.node.cornerRadius,$=12,B=Math.min(this.aggregatedCount-1,3),M=4;for(let V=B;V>=1;V--){let G=V*4,H=V*4,k=document.createElementNS("http://www.w3.org/2000/svg","path");k.setAttribute("class","aggregate-stack");let z=`
                M ${K+G} ${H}
                L ${q-12+G} ${H}
                L ${q+G} ${12+H}
                L ${q+G} ${J-K+H}
                Q ${q+G} ${J+H}, ${q-K+G} ${J+H}
                L ${K+G} ${J+H}
                Q ${G} ${J+H}, ${G} ${J-K+H}
                L ${G} ${K+H}
                Q ${G} ${H}, ${K+G} ${H}
                Z
            `.trim().replace(/\s+/g," ");k.setAttribute("d",z);let X=this.getStateColors();k.setAttribute("fill",X.background),k.setAttribute("stroke",X.border),k.setAttribute("stroke-width","1"),k.setAttribute("opacity",(0.3+(B-V)*0.15).toString()),k.style.transition="opacity 0.3s ease",j.appendChild(k),this.stackElements.push(k)}}renderCounter(j){let q=Q.node.width,J=12,K=q-6,$=-6;this.counterBadge=document.createElementNS("http://www.w3.org/2000/svg","g"),this.counterBadge.setAttribute("class","aggregate-counter");let B=document.createElementNS("http://www.w3.org/2000/svg","circle");B.setAttribute("cx",K.toString()),B.setAttribute("cy",(-6).toString()),B.setAttribute("r",12 .toString()),B.setAttribute("fill","#0a6ed1"),B.setAttribute("stroke","#ffffff"),B.setAttribute("stroke-width","2"),this.counterBadge.appendChild(B);let M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("x",K.toString()),M.setAttribute("y",(-5).toString()),M.setAttribute("text-anchor","middle"),M.setAttribute("dominant-baseline","middle"),M.setAttribute("font-size","10"),M.setAttribute("font-weight","bold"),M.setAttribute("fill","#ffffff"),M.setAttribute("font-family",'"72", "72full", Arial, Helvetica, sans-serif');let V=this.aggregatedCount>99?"99+":this.aggregatedCount.toString();M.textContent=V,this.counterBadge.appendChild(M),j.appendChild(this.counterBadge)}expandAggregate(){if(!this.isAggregated||this.isExpanded)return[];this.isExpanded=!0,this.element.classList.add("aggregate-expanded");for(let j of this.stackElements)j.style.opacity="0";if(this.counterBadge)this.counterBadge.style.opacity="0";return this.aggregatedItems}collapseAggregate(){if(!this.isAggregated||!this.isExpanded)return;this.isExpanded=!1,this.element.classList.remove("aggregate-expanded");let j=Math.min(this.aggregatedCount-1,3);for(let q=0;q<this.stackElements.length;q++){let J=this.stackElements[q];J.style.opacity=(0.3+(j-q-1)*0.15).toString()}if(this.counterBadge)this.counterBadge.style.opacity="1"}isAggregateExpanded(){return this.isExpanded}setPosition(j,q){this.x=j,this.y=q,this.element.setAttribute("transform",`translate(${j}, ${q})`)}getWidth(){return this.currentZoomConfig.nodeWidth}getHeight(){return this.currentZoomConfig.nodeHeight}setZoomLevel(j){this.currentZoomLevel=j,this.currentZoomConfig=u[j];let q=this.currentZoomConfig;if(this.updateNodeShape(q.nodeWidth,q.nodeHeight),this.updateElementVisibility(q),this.statusIcon)this.statusIcon.setAttribute("x",(q.nodeWidth/2).toString()),this.statusIcon.setAttribute("y",(q.nodeHeight/2+4).toString())}getZoomLevel(){return this.currentZoomLevel}updateNodeShape(j,q){let J=Math.min(Q.node.cornerRadius,j/10),K=Math.min(12,j/13),$;if(this.foldedCorners)$=`
                M ${J} 0
                L ${j-K} 0
                L ${j} ${K}
                L ${j} ${q-J}
                Q ${j} ${q}, ${j-J} ${q}
                L ${J} ${q}
                Q 0 ${q}, 0 ${q-J}
                L 0 ${J}
                Q 0 0, ${J} 0
                Z
            `.trim().replace(/\s+/g," ");else $=`
                M ${J} 0
                L ${j-J} 0
                Q ${j} 0, ${j} ${J}
                L ${j} ${q-J}
                Q ${j} ${q}, ${j-J} ${q}
                L ${J} ${q}
                Q 0 ${q}, 0 ${q-J}
                L 0 ${J}
                Q 0 0, ${J} 0
                Z
            `.trim().replace(/\s+/g," ");if(this.background.setAttribute("d",$),this.borderPath.setAttribute("d",$),this.foldTriangle&&this.foldedCorners){let B=`
                M ${j-K} 0
                L ${j-K} ${K}
                L ${j} ${K}
                Z
            `.trim().replace(/\s+/g," ");this.foldTriangle.setAttribute("d",B)}}updateElementVisibility(j){if(this.titleText.style.display=j.showHeader?"block":"none",this.stateText.style.display=j.showStatus&&j.showHeader?"block":"none",this.icon)this.icon.style.display=j.showHeader?"block":"none";for(let q=0;q<this.detailTexts.length;q++)if(q===0)this.detailTexts[q].style.display=j.showAttr1?"block":"none";else if(q===1)this.detailTexts[q].style.display=j.showAttr2?"block":"none";else this.detailTexts[q].style.display=j.showAttr2?"block":"none";if(this.statusIcon)this.statusIcon.style.display=!j.showHeader&&j.showStatus?"block":"none"}setState(j){if(this.state=j,this.updateColors(),this.stateText.textContent=this.getStateLabel(),this.statusIcon)this.statusIcon.textContent=this.getIconForState()}setDisplayState(j){switch(this.displayState=j,j){case"Highlighted":this.element.style.filter="drop-shadow(0 4px 8px rgba(10,110,209,0.4))",this.element.style.transform="scale(1.05)";break;case"Dimmed":this.element.style.opacity="0.4";break;case"Selected":this.element.style.filter="drop-shadow(0 0 12px rgba(10,110,209,0.6))",this.borderPath.setAttribute("stroke-width","3");break;case"Regular":default:this.element.style.filter="",this.element.style.transform="scale(1.0)",this.element.style.opacity="1.0",this.borderPath.setAttribute("stroke-width",Q.node.borderWidth.toString())}}updateColors(){let j=this.getStateColors();this.background.setAttribute("fill",j.background),this.borderPath.setAttribute("stroke",j.border),this.titleText.setAttribute("fill",j.text),this.stateText.setAttribute("fill",j.text);for(let q of this.detailTexts)q.setAttribute("fill",j.text);if(this.icon)this.icon.setAttribute("fill",j.text);if(this.statusIcon)this.statusIcon.setAttribute("fill",j.text)}getStateColors(){switch(this.state){case"Positive":return Z.positive;case"Negative":return Z.negative;case"Critical":return Z.critical;case"Planned":return Z.planned;case"PlannedNegative":return Z.plannedNegative;case"Neutral":default:return Z.neutral}}getStateLabel(){switch(this.state){case"Positive":return"Completed";case"Negative":return"Failed";case"Critical":return"Warning";case"Planned":return"Planned";case"PlannedNegative":return"Planned (Issue)";case"Neutral":return"In Progress";default:return""}}getIconForState(){switch(this.state){case"Positive":return"✓";case"Negative":return"✗";case"Critical":return"⚠";case"Neutral":return"▶";default:return""}}needsIcon(){return this.state!=="Planned"&&this.state!=="PlannedNegative"}truncateText(j,q){if(j.length<=q)return j;return j.substring(0,q-3)+"..."}setHighlighted(j){if(j)this.element.classList.add("highlighted"),this.element.classList.remove("dimmed"),this.element.style.filter="drop-shadow(0 0 8px rgba(10, 110, 209, 0.6))",this.borderPath.setAttribute("stroke-width","3");else this.element.classList.remove("highlighted"),this.element.style.filter="",this.borderPath.setAttribute("stroke-width",Q.node.borderWidth.toString())}setDimmed(j){if(j)this.element.classList.add("dimmed"),this.element.classList.remove("highlighted"),this.element.style.opacity="0.3",this.element.style.filter="grayscale(50%)";else this.element.classList.remove("dimmed"),this.element.style.opacity="1",this.element.style.filter=""}toJSON(){let j={id:this.id,lane:this.lane,title:this.title,state:this.state,texts:this.texts,children:this.children,position:this.position,foldedCorners:this.foldedCorners};if(this.isAggregated)j.isAggregated=this.isAggregated,j.aggregatedCount=this.aggregatedCount,j.aggregatedItems=this.aggregatedItems;return j}destroy(){if(this.element&&this.element.parentNode)this.element.parentNode.removeChild(this.element)}}class N{id;label;position;state;element;background;labelText;icon=null;y=0;height=Q.node.height;constructor(j){this.id=j.id,this.label=j.label,this.position=j.position,this.state=j.state,this.element=this.createElement()}createElement(){let j=document.createElementNS("http://www.w3.org/2000/svg","g");return j.setAttribute("class","process-flow-lane"),j.setAttribute("data-lane-id",this.id),this.background=this.createBackground(),j.appendChild(this.background),this.labelText=this.createLabel(),j.appendChild(this.labelText),j}createBackground(){let j=document.createElementNS("http://www.w3.org/2000/svg","rect");return j.setAttribute("class","lane-background"),j.setAttribute("width",Q.spacing.laneHeader.toString()),j.setAttribute("height",this.height.toString()),j.setAttribute("fill",this.position%2===0?Z.lane.default:Z.lane.alternate),j.setAttribute("stroke",Z.border),j.setAttribute("stroke-width","1"),j}createLabel(){let j=document.createElementNS("http://www.w3.org/2000/svg","text");return j.setAttribute("class","lane-label"),j.setAttribute("x",(Q.spacing.laneHeader/2).toString()),j.setAttribute("y",(this.height/2).toString()),j.setAttribute("text-anchor","middle"),j.setAttribute("dominant-baseline","middle"),j.setAttribute("font-size","13"),j.setAttribute("font-weight","600"),j.setAttribute("fill",Z.text.primary),j.textContent=this.label,j}setPosition(j){this.y=j,this.element.setAttribute("transform",`translate(0, ${j})`)}setHeight(j){this.height=j,this.background.setAttribute("height",j.toString()),this.labelText.setAttribute("y",(j/2).toString())}destroy(){if(this.element&&this.element.parentNode)this.element.parentNode.removeChild(this.element)}}var T={Positive:"#107e3e",Negative:"#bb0000",Neutral:"#0070f2",Critical:"#df6e0c"};class m{id;from;to;state;type;element;path;arrow;label=null;labelElement=null;labelClickCallback=null;sourceNode=null;targetNode=null;constructor(j){this.id=`${j.from}-${j.to}`,this.from=j.from,this.to=j.to,this.state=j.state||"Normal",this.type=j.type||"normal",this.element=this.createElement()}createElement(){let j=document.createElementNS("http://www.w3.org/2000/svg","g");return j.setAttribute("class","process-flow-connection"),j.setAttribute("data-from",this.from),j.setAttribute("data-to",this.to),this.path=this.createPath(),j.appendChild(this.path),this.arrow=this.createArrow(),j.appendChild(this.arrow),j}createPath(){let j=document.createElementNS("http://www.w3.org/2000/svg","path");if(j.setAttribute("class","connection-path"),j.setAttribute("fill","none"),j.setAttribute("stroke",this.getStateColor()),j.setAttribute("stroke-width",Q.connection.strokeWidth.toString()),j.setAttribute("stroke-linecap","round"),j.setAttribute("stroke-linejoin","round"),this.type==="planned")j.setAttribute("stroke-dasharray",Q.connection.dashArray);return j.style.transition="stroke 0.3s ease",j}createArrow(){let j=document.createElementNS("http://www.w3.org/2000/svg","polygon");return j.setAttribute("class","connection-arrow"),j.setAttribute("fill",this.getStateColor()),j.style.transition="fill 0.3s ease",j}setNodes(j,q){this.sourceNode=j,this.targetNode=q,this.updatePath()}updatePath(){if(!this.sourceNode||!this.targetNode)return;let j=this.sourceNode.x+this.sourceNode.getWidth(),q=this.sourceNode.y+this.sourceNode.getHeight()/2,J=this.targetNode.x,K=this.targetNode.y+this.targetNode.getHeight()/2,$=this.createRoundedPath({x:j,y:q},{x:J,y:K});this.path.setAttribute("d",$),this.positionArrow({x:J,y:K})}createRoundedPath(j,q){let J=q.x-j.x,K=q.y-j.y,$=Q.connection.cornerRadius;if(Math.abs(K)<2)return`M ${j.x} ${j.y} L ${q.x} ${q.y}`;let B=j.x+J/2;if(K>0){let M=Math.min($,Math.abs(J)/2),V=Math.min($,Math.abs(K)/2);return`
                M ${j.x} ${j.y}
                L ${B-M} ${j.y}
                Q ${B} ${j.y}, ${B} ${j.y+V}
                L ${B} ${q.y-V}
                Q ${B} ${q.y}, ${B+M} ${q.y}
                L ${q.x} ${q.y}
            `.trim().replace(/\s+/g," ")}else{let M=Math.min($,Math.abs(J)/2),V=Math.min($,Math.abs(K)/2);return`
                M ${j.x} ${j.y}
                L ${B-M} ${j.y}
                Q ${B} ${j.y}, ${B} ${j.y-V}
                L ${B} ${q.y+V}
                Q ${B} ${q.y}, ${B+M} ${q.y}
                L ${q.x} ${q.y}
            `.trim().replace(/\s+/g," ")}}positionArrow(j){let q=Q.connection.arrowSize,J=j,K={x:J.x-q,y:J.y-q/2},$={x:J.x-q,y:J.y+q/2},B=`${J.x},${J.y} ${K.x},${K.y} ${$.x},${$.y}`;this.arrow.setAttribute("points",B)}setState(j){this.state=j;let q=this.getStateColor();this.path.setAttribute("stroke",q),this.arrow.setAttribute("fill",q)}getStateColor(){switch(this.state){case"Highlighted":return Z.connection.highlighted;case"Dimmed":return Z.connection.dimmed;case"Normal":default:return Z.connection.normal}}animate(){this.path.animate([{strokeWidth:Q.connection.strokeWidth},{strokeWidth:Q.connection.strokeWidth+2},{strokeWidth:Q.connection.strokeWidth}],{duration:800,easing:Q.animation.easing})}setLabel(j){if(this.label=j,j)this.renderLabel();else this.removeLabel()}getLabel(){return this.label}onLabelClick(j){this.labelClickCallback=j}renderLabel(){if(!this.label)return;this.removeLabel(),this.labelElement=document.createElementNS("http://www.w3.org/2000/svg","g"),this.labelElement.setAttribute("class","connection-label"),this.labelElement.style.cursor="pointer";let j=this.label.text,q=!!this.label.icon,J=11,K=8,$=4,B=q?14:0,M=j.length*6,V=M+B+K*2+(q?4:0),G=J+$*2,H=G/2,k=T[this.label.state],z=document.createElementNS("http://www.w3.org/2000/svg","rect");z.setAttribute("x",(-V/2).toString()),z.setAttribute("y",(-G/2).toString()),z.setAttribute("width",V.toString()),z.setAttribute("height",G.toString()),z.setAttribute("rx",H.toString()),z.setAttribute("ry",H.toString()),z.setAttribute("fill",k),z.style.filter="drop-shadow(0 1px 2px rgba(0,0,0,0.2))",this.labelElement.appendChild(z);let X=0;if(q&&this.label.icon){X=-M/2-2;let D=document.createElementNS("http://www.w3.org/2000/svg","text");D.setAttribute("x",X.toString()),D.setAttribute("y","4"),D.setAttribute("font-family","SAP-icons"),D.setAttribute("font-size","12"),D.setAttribute("fill","white"),D.setAttribute("text-anchor","middle"),D.textContent=this.label.icon,this.labelElement.appendChild(D)}let b=document.createElementNS("http://www.w3.org/2000/svg","text"),I=q?X+B+2:0;b.setAttribute("x",I.toString()),b.setAttribute("y","4"),b.setAttribute("font-family",'"72", "72full", Arial, Helvetica, sans-serif'),b.setAttribute("font-size",J.toString()),b.setAttribute("font-weight","600"),b.setAttribute("fill","white"),b.setAttribute("text-anchor",q?"start":"middle"),b.textContent=j,this.labelElement.appendChild(b),this.labelElement.addEventListener("click",(D)=>{if(D.stopPropagation(),this.labelClickCallback)this.labelClickCallback(this)}),this.labelElement.addEventListener("mouseenter",()=>{z.style.filter="drop-shadow(0 2px 4px rgba(0,0,0,0.3))",z.setAttribute("opacity","0.9")}),this.labelElement.addEventListener("mouseleave",()=>{z.style.filter="drop-shadow(0 1px 2px rgba(0,0,0,0.2))",z.setAttribute("opacity","1")}),this.element.appendChild(this.labelElement),this.positionLabel()}positionLabel(){if(!this.labelElement||!this.sourceNode||!this.targetNode)return;let j=this.sourceNode.x+this.sourceNode.getWidth(),q=this.sourceNode.y+this.sourceNode.getHeight()/2,J=this.targetNode.x,K=this.targetNode.y+this.targetNode.getHeight()/2,$=j+(J-j)/2,B=(q+K)/2;this.labelElement.setAttribute("transform",`translate(${$}, ${B})`)}removeLabel(){if(this.labelElement&&this.labelElement.parentNode)this.labelElement.parentNode.removeChild(this.labelElement),this.labelElement=null}setHighlighted(j){if(j)this.element.classList.add("highlighted"),this.element.classList.remove("dimmed"),this.path.setAttribute("stroke",Z.connection.highlighted),this.path.setAttribute("stroke-width","3"),this.arrow.setAttribute("fill",Z.connection.highlighted),this.element.style.filter="drop-shadow(0 0 4px rgba(10, 110, 209, 0.5))";else this.element.classList.remove("highlighted"),this.path.setAttribute("stroke",this.getStateColor()),this.path.setAttribute("stroke-width",Q.connection.strokeWidth.toString()),this.arrow.setAttribute("fill",this.getStateColor()),this.element.style.filter=""}setDimmed(j){if(j)this.element.classList.add("dimmed"),this.element.classList.remove("highlighted"),this.path.setAttribute("stroke",Z.connection.dimmed),this.arrow.setAttribute("fill",Z.connection.dimmed),this.element.style.opacity="0.3";else this.element.classList.remove("dimmed"),this.path.setAttribute("stroke",this.getStateColor()),this.arrow.setAttribute("fill",this.getStateColor()),this.element.style.opacity="1"}destroy(){if(this.removeLabel(),this.element&&this.element.parentNode)this.element.parentNode.removeChild(this.element)}}class Y{container;svg;contentGroup;lanesGroup;connectionsGroup;nodesGroup;nodes=new Map;lanes=new Map;connections=new Map;config;lanePositions=new Map;columnPositions=[];selectedNodeId=null;hoveredNodeId=null;eventListeners=new Map;currentZoomLevel="Two";isAutoZoom=!0;resizeObserver=null;leftOverflowIndicator=null;rightOverflowIndicator=null;constructor(j,q){if(typeof j==="string"){let J=document.querySelector(j);if(!J)throw Error(`Container ${j} not found`);this.container=J}else this.container=j;this.config={...U,...q},this.init()}init(){if(this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("class","process-flow-svg"),this.svg.style.width="100%",this.svg.style.height="100%",this.svg.style.fontFamily='"72", "72full", Arial, Helvetica, sans-serif',this.contentGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.contentGroup.setAttribute("class","process-flow-content"),this.svg.appendChild(this.contentGroup),this.lanesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.lanesGroup.setAttribute("class","process-flow-lanes"),this.contentGroup.appendChild(this.lanesGroup),this.connectionsGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.connectionsGroup.setAttribute("class","process-flow-connections"),this.contentGroup.appendChild(this.connectionsGroup),this.nodesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.nodesGroup.setAttribute("class","process-flow-nodes"),this.contentGroup.appendChild(this.nodesGroup),this.container.appendChild(this.svg),this.createOverflowIndicators(),this.setupInteractions(),this.setupResizeObserver(),this.config.zoomLevel)this.isAutoZoom=!1,this.setZoomLevel(this.config.zoomLevel);else this.isAutoZoom=!0,this.updateAutoZoomLevel()}createOverflowIndicators(){if(this.leftOverflowIndicator=document.createElement("div"),this.leftOverflowIndicator.className="process-flow-overflow-indicator process-flow-overflow-left",this.leftOverflowIndicator.style.cssText=`
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(10, 110, 209, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            font-family: "72", "72full", Arial, Helvetica, sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            z-index: 100;
            box-shadow: 2px 0 8px rgba(0,0,0,0.15);
            transition: background 0.2s ease;
        `,this.leftOverflowIndicator.addEventListener("mouseenter",()=>{this.leftOverflowIndicator.style.background="rgba(10, 110, 209, 1)"}),this.leftOverflowIndicator.addEventListener("mouseleave",()=>{this.leftOverflowIndicator.style.background="rgba(10, 110, 209, 0.9)"}),this.container.appendChild(this.leftOverflowIndicator),this.rightOverflowIndicator=document.createElement("div"),this.rightOverflowIndicator.className="process-flow-overflow-indicator process-flow-overflow-right",this.rightOverflowIndicator.style.cssText=`
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(10, 110, 209, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 4px 0 0 4px;
            font-family: "72", "72full", Arial, Helvetica, sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            z-index: 100;
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);
            transition: background 0.2s ease;
        `,this.rightOverflowIndicator.addEventListener("mouseenter",()=>{this.rightOverflowIndicator.style.background="rgba(10, 110, 209, 1)"}),this.rightOverflowIndicator.addEventListener("mouseleave",()=>{this.rightOverflowIndicator.style.background="rgba(10, 110, 209, 0.9)"}),this.container.appendChild(this.rightOverflowIndicator),getComputedStyle(this.container).position==="static")this.container.style.position="relative"}setupResizeObserver(){this.resizeObserver=new ResizeObserver((j)=>{for(let q of j)if(q.target===this.container){if(this.isAutoZoom)this.updateAutoZoomLevel();this.updateOverflowIndicators()}}),this.resizeObserver.observe(this.container)}detectZoomLevel(){let j=this.container.clientWidth;if(j>=1024)return"Two";if(j>=600)return"Three";return"Four"}updateAutoZoomLevel(){let j=this.detectZoomLevel();if(j!==this.currentZoomLevel)this.applyZoomLevel(j)}setupInteractions(){if(this.svg.addEventListener("click",(j)=>{let J=j.target.closest(".process-flow-node");if(J){let K=J.getAttribute("data-node-id");if(K)this.handleNodeClick(K,j)}}),this.svg.addEventListener("mouseover",(j)=>{let J=j.target.closest(".process-flow-node");if(J){let K=J.getAttribute("data-node-id");if(K)this.handleNodeHover(K)}}),this.svg.addEventListener("mouseout",(j)=>{if(j.target.closest(".process-flow-node"))this.handleNodeLeave()}),this.config.wheelZoomable)this.svg.addEventListener("wheel",(j)=>{j.preventDefault(),this.handleWheel(j)})}setLanes(j){this.lanes.clear(),this.lanePositions.clear(),j.sort((q,J)=>q.position-J.position);for(let q of j){let J=new N(q);this.lanes.set(q.id,J),this.lanesGroup.appendChild(J.element)}this.updateLayout()}setNodes(j){this.nodes.clear();for(let q of j){let J=new y(q);this.nodes.set(q.id,J),this.nodesGroup.appendChild(J.element)}this.updateLayout()}setConnections(j){this.connections.clear();for(let q of j){let J=new m(q),K=this.nodes.get(q.from),$=this.nodes.get(q.to);if(K&&$)J.setNodes(K,$),this.connections.set(J.id,J),this.connectionsGroup.appendChild(J.element)}}loadData(j){this.setLanes(j.lanes),this.setNodes(j.nodes),this.setConnections(j.connections)}updateLayout(){this.calculateLanePositions(),this.calculateColumnPositions(),this.positionNodes(),this.updateConnections(),this.updateSVGSize()}calculateLanePositions(){let j=Array.from(this.lanes.values());j.sort((J,K)=>J.position-K.position);let q=Q.spacing.topMargin;for(let J of j)this.lanePositions.set(J.id,q),J.setPosition(q),q+=Q.node.height+Q.spacing.vertical}calculateColumnPositions(){let j=new Map;for(let K of this.nodes.values()){let $=K.position;if(!j.has($))j.set($,[]);j.get($).push(K.toJSON())}this.columnPositions=[];let q=Q.spacing.laneHeader+Q.spacing.leftMargin,J=Math.max(...Array.from(j.keys()));for(let K=0;K<=J;K++)this.columnPositions.push(q),q+=Q.node.width+Q.spacing.horizontal}positionNodes(){for(let j of this.nodes.values()){let q=this.lanePositions.get(j.lane),J=this.columnPositions[j.position];if(q!==void 0&&J!==void 0)j.setPosition(J,q)}}updateConnections(){for(let j of this.connections.values())j.updatePath()}updateSVGSize(){let j=Math.max(...Array.from(this.nodes.values()).map(($)=>$.position)),q=this.columnPositions[j]+Q.node.width+Q.spacing.rightMargin,K=Array.from(this.lanes.values()).length*(Q.node.height+Q.spacing.vertical)+Q.spacing.topMargin+Q.spacing.bottomMargin;this.svg.setAttribute("viewBox",`0 0 ${q} ${K}`)}handleNodeClick(j,q){let J=this.nodes.get(j);if(!J)return;if(this.selectedNodeId===j)this.selectedNodeId=null,this.clearSelection();else this.selectedNodeId=j,this.highlightNode(j);this.emit("nodeClick",{type:"click",node:J.toJSON(),originalEvent:q})}handleNodeHover(j){if(this.hoveredNodeId===j)return;this.hoveredNodeId=j;let q=this.nodes.get(j);if(q)q.setDisplayState("Highlighted")}handleNodeLeave(){if(this.hoveredNodeId){let j=this.nodes.get(this.hoveredNodeId);if(j&&this.selectedNodeId!==this.hoveredNodeId)j.setDisplayState("Regular");this.hoveredNodeId=null}}handleWheel(j){let q=j.deltaY>0?-1:1;this.adjustZoom(q)}highlightNode(j){if(!this.nodes.get(j))return;let J=this.getConnectedNodes(j);for(let[K,$]of this.nodes)if(K===j)$.setDisplayState("Selected");else if(J.has(K))$.setDisplayState("Highlighted");else $.setDisplayState("Dimmed")}clearSelection(){for(let j of this.nodes.values())j.setDisplayState("Regular")}getConnectedNodes(j){let q=new Set;for(let J of this.connections.values()){if(J.from===j)q.add(J.to);if(J.to===j)q.add(J.from)}return q}highlightPath(j){let q=new Set(j);this.dimNonPathElements(j);for(let J of j){let K=this.nodes.get(J);if(K)K.setHighlighted(!0)}for(let J of this.connections.values())if(q.has(J.from)&&q.has(J.to))J.setHighlighted(!0)}clearHighlight(){for(let j of this.nodes.values())j.setHighlighted(!1),j.setDimmed(!1);for(let j of this.connections.values())j.setHighlighted(!1),j.setDimmed(!1)}dimNonPathElements(j){let q=new Set(j);for(let[J,K]of this.nodes)if(!q.has(J))K.setDimmed(!0);else K.setDimmed(!1);for(let J of this.connections.values())if(!(q.has(J.from)&&q.has(J.to)))J.setDimmed(!0);else J.setDimmed(!1)}setZoomLevel(j){this.isAutoZoom=!1,this.applyZoomLevel(j)}getZoomLevel(){return this.currentZoomLevel}enableAutoZoom(){this.isAutoZoom=!0,this.updateAutoZoomLevel()}applyZoomLevel(j){this.currentZoomLevel=j,this.config.zoomLevel=j;let q=u[j];for(let J of this.nodes.values())J.setZoomLevel(j);this.contentGroup.setAttribute("transform",`scale(${q.scale})`),this.contentGroup.setAttribute("data-zoom",j),this.updateLayout(),this.updateOverflowIndicators(),this.emit("zoomChange",{level:j,config:q})}adjustZoom(j){let q=["Four","Three","Two","One"],J=q.indexOf(this.currentZoomLevel),K=Math.max(0,Math.min(q.length-1,J+j));if(q[K]!==this.currentZoomLevel)this.isAutoZoom=!1,this.applyZoomLevel(q[K])}updateOverflowIndicators(){if(!this.leftOverflowIndicator||!this.rightOverflowIndicator)return;let j=this.container.getBoundingClientRect(),J=u[this.currentZoomLevel].scale,K=0,$=j.width/J,B=0,M=0;for(let V of this.nodes.values()){let G=V.x+V.getWidth(),H=V.x;if(G<K)B++;else if(H>$)M++}if(B>0)this.leftOverflowIndicator.textContent=`< ${B}`,this.leftOverflowIndicator.style.display="block";else this.leftOverflowIndicator.style.display="none";if(M>0)this.rightOverflowIndicator.textContent=`${M} >`,this.rightOverflowIndicator.style.display="block";else this.rightOverflowIndicator.style.display="none"}on(j,q){if(!this.eventListeners.has(j))this.eventListeners.set(j,[]);this.eventListeners.get(j).push(q)}off(j,q){if(!this.eventListeners.has(j))return;if(q){let J=this.eventListeners.get(j),K=J.indexOf(q);if(K>-1)J.splice(K,1)}else this.eventListeners.delete(j)}emit(j,q){if(!this.eventListeners.has(j))return;for(let J of this.eventListeners.get(j))J(q)}getNode(j){return this.nodes.get(j)}selectNode(j){if(j===null)this.selectedNodeId=null,this.clearSelection();else this.selectedNodeId=j,this.highlightNode(j)}exportData(){return{lanes:Array.from(this.lanes.values()).map((j)=>({id:j.id,label:j.label,position:j.position})),nodes:Array.from(this.nodes.values()).map((j)=>j.toJSON()),connections:Array.from(this.connections.values()).map((j)=>({from:j.from,to:j.to,state:j.state,type:j.type}))}}destroy(){if(this.resizeObserver)this.resizeObserver.disconnect(),this.resizeObserver=null;if(this.leftOverflowIndicator&&this.leftOverflowIndicator.parentNode)this.leftOverflowIndicator.parentNode.removeChild(this.leftOverflowIndicator);if(this.rightOverflowIndicator&&this.rightOverflowIndicator.parentNode)this.rightOverflowIndicator.parentNode.removeChild(this.rightOverflowIndicator);for(let j of this.nodes.values())j.destroy();for(let j of this.lanes.values())j.destroy();for(let j of this.connections.values())j.destroy();if(this.nodes.clear(),this.lanes.clear(),this.connections.clear(),this.svg&&this.svg.parentNode)this.svg.parentNode.removeChild(this.svg)}}export{Y as ProcessFlow};
