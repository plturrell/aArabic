/*
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./SelectionPlugin","../library","../utils/TableUtils","sap/ui/core/Icon","sap/ui/core/IconPool","sap/base/Log"],function(e,t,i,n,o,l){"use strict";var r=t.SelectionMode;var s=e.extend("sap.ui.table.plugins.MultiSelectionPlugin",{metadata:{library:"sap.ui.table",properties:{limit:{type:"int",group:"Behavior",defaultValue:200},enableNotification:{type:"boolean",group:"Behavior",defaultValue:false},showHeaderSelector:{type:"boolean",group:"Appearance",defaultValue:true},selectionMode:{type:"sap.ui.table.SelectionMode",group:"Behavior",defaultValue:r.MultiToggle}},events:{selectionChange:{parameters:{indices:{type:"int[]"},limitReached:{type:"boolean"},customPayload:{type:"object"}}}}}});s.prototype.init=function(){e.prototype.init.apply(this,arguments);var t=new n({src:o.getIconURI(i.ThemeParameters.clearSelectionIcon),useIconTooltip:false});t.addStyleClass("sapUiTableSelectClear");this._bLimitReached=false;this._bLimitDisabled=this.getLimit()===0;this.oInnerSelectionPlugin=null;this.oDeselectAllIcon=t};s.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this.oDeselectAllIcon){this.oDeselectAllIcon.destroy();this.oDeselectAllIcon=null}};s.prototype.onActivate=function(t){e.prototype.onActivate.apply(this,arguments);this.oInnerSelectionPlugin=t._createLegacySelectionPlugin();this.oInnerSelectionPlugin.attachSelectionChange(this._onSelectionChange,this);t.addAggregation("_hiddenDependents",this.oInnerSelectionPlugin);t.setProperty("selectionMode",this.getSelectionMode())};s.prototype.onDeactivate=function(t){e.prototype.onDeactivate.apply(this,arguments);t.setProperty("selectionMode",r.None);if(this.oInnerSelectionPlugin){this.oInnerSelectionPlugin.destroy();this.oInnerSelectionPlugin=null}};s.prototype.setSelected=function(e,t,i){if(!this.isIndexSelectable(e.getIndex())){return}if(i&&i.range){var n=this.getSelectedIndex();if(n>=0){this.addSelectionInterval(n,e.getIndex())}}else if(t){this.addSelectionInterval(e.getIndex(),e.getIndex())}else{this.removeSelectionInterval(e.getIndex(),e.getIndex())}};s.prototype.isSelected=function(e){return this.isIndexSelected(e.getIndex())};s.prototype.getRenderConfig=function(){if(!this.isActive()){return e.prototype.getRenderConfig.apply(this,arguments)}return{headerSelector:{type:this._bLimitDisabled?"toggle":"clear",icon:this.oDeselectAllIcon,visible:this.getSelectionMode()===r.MultiToggle&&this.getShowHeaderSelector(),enabled:this._bLimitDisabled||this.getSelectedCount()>0,selected:this.getSelectableCount()>0&&this.getSelectableCount()===this.getSelectedCount()}}};s.prototype.onHeaderSelectorPress=function(){var e=this.getRenderConfig();if(!e.headerSelector.visible||!e.headerSelector.enabled){return}if(e.headerSelector.type==="toggle"){a(this)}else if(e.headerSelector.type==="clear"){this.clearSelection()}};s.prototype.onKeyboardShortcut=function(e,t){if(e==="toggle"){if(this._bLimitDisabled&&a(this)===false){t?.setMarked("sapUiTableClearAll")}}else if(e==="clear"){this.clearSelection();t?.setMarked("sapUiTableClearAll")}};function a(e){if(e.getSelectableCount()>e.getSelectedCount()){e.selectAll();return true}else{e.clearSelection();return false}}s.prototype.setSelectionMode=function(e){var t=this.getParent();if(t){t.setProperty("selectionMode",e,true)}if(this.oInnerSelectionPlugin){this.oInnerSelectionPlugin.setSelectionMode(e)}this.setProperty("selectionMode",e);return this};s.prototype.setLimit=function(e){if(typeof e==="number"&&e<0){l.warning("The limit must be greater than or equal to 0",this);return this}this.setProperty("limit",e,!!this.getLimit()===!!e);this._bLimitDisabled=e===0;return this};s.prototype.setEnableNotification=function(e){this.setProperty("enableNotification",e,true);return this};s.prototype.isLimitReached=function(){return this._bLimitReached};s.prototype.setLimitReached=function(e){this._bLimitReached=e};s.prototype.selectAll=function(e){if(!this._bLimitDisabled){return Promise.reject(new Error("Not possible if the limit is enabled"))}var t=this.getSelectableCount();if(t===0){return Promise.reject(new Error("Nothing to select"))}return this.addSelectionInterval(0,this._getHighestSelectableIndex(),e)};function c(e,t,n,o){var l=e._getHighestSelectableIndex();if(t<0&&n<0||t>l&&n>l){return Promise.reject(new Error("Out of range"))}t=Math.min(Math.max(0,t),l);n=Math.min(Math.max(0,n),l);var r=e.getLimit();var s=n<t;var a=s?n:t;var c;if(o&&e.isIndexSelected(t)){if(s){t--}else if(t!==n){t++;a++}}c=Math.abs(n-t)+1;if(!e._bLimitDisabled){e.setLimitReached(c>r);if(e.isLimitReached()){if(s){n=t-r+1;a=n-1}else{n=t+r-1}c=r+1}}return i.loadContexts(e.getTableBinding(),a,c).then(function(){return{indexFrom:t,indexTo:n}})}s.prototype.setSelectionInterval=function(e,t,n){var o=this.getTable();var l=this.getSelectionMode();if(l===r.None){return Promise.reject(new Error("SelectionMode is '"+r.None+"'"))}if(l===r.Single){e=t}return c(this,e,t,false).then(function(e){this._oCustomEventPayloadTmp=n;this.oInnerSelectionPlugin.setSelectionInterval(e.indexFrom,e.indexTo);delete this._oCustomEventPayloadTmp;if(!this.isLimitReached()){return Promise.resolve()}return i.scrollTableToIndex(o,e.indexTo,e.indexFrom>e.indexTo).then(function(){if(!this.getEnableNotification()){return Promise.resolve()}return i.showNotificationPopoverAtIndex(o,e.indexTo,this.getLimit())}.bind(this))}.bind(this))};s.prototype.setSelectedIndex=function(e,t){return this.setSelectionInterval(e,e,t)};s.prototype.addSelectionInterval=function(e,t,n){var o=this.getTable();var l=this.getSelectionMode();if(l===r.None){return Promise.reject(new Error("SelectionMode is '"+r.None+"'"))}if(l===r.Single){return this.setSelectionInterval(t,t)}if(l===r.MultiToggle){return c(this,e,t,true).then(function(e){this._oCustomEventPayloadTmp=n;this.oInnerSelectionPlugin.addSelectionInterval(e.indexFrom,e.indexTo);delete this._oCustomEventPayloadTmp;if(!this.isLimitReached()){return Promise.resolve()}return i.scrollTableToIndex(o,e.indexTo,e.indexFrom>e.indexTo).then(function(){if(!this.getEnableNotification()){return Promise.resolve()}return i.showNotificationPopoverAtIndex(o,e.indexTo,this.getLimit())}.bind(this))}.bind(this))}};s.prototype.clearSelection=function(e){if(this.oInnerSelectionPlugin){this.setLimitReached(false);this._oCustomEventPayloadTmp=e;this.oInnerSelectionPlugin.clearSelection();delete this._oCustomEventPayloadTmp}};s.prototype.getSelectedIndex=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectedIndex()}return-1};s.prototype.getSelectedIndices=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectedIndices()}return[]};s.prototype.getSelectableCount=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectableCount()}return 0};s.prototype.getSelectedCount=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectedCount()}return 0};s.prototype.isIndexSelectable=function(e){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.isIndexSelectable(e)}return false};s.prototype.isIndexSelected=function(e){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.isIndexSelected(e)}return false};s.prototype.removeSelectionInterval=function(e,t,i){if(this.oInnerSelectionPlugin){this.setLimitReached(false);this._oCustomEventPayloadTmp=i;this.oInnerSelectionPlugin.removeSelectionInterval(e,t);delete this._oCustomEventPayloadTmp}};s.prototype._onSelectionChange=function(e){var t=e.getParameter("rowIndices");this.fireSelectionChange({rowIndices:t,limitReached:this.isLimitReached(),customPayload:typeof this._oCustomEventPayloadTmp==="object"?this._oCustomEventPayloadTmp:null,_internalTrigger:e.getParameter("_internalTrigger")})};s.prototype._getHighestSelectableIndex=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin._getHighestSelectableIndex()}return 0};s.prototype.onThemeChanged=function(){this.oDeselectAllIcon.setSrc(o.getIconURI(i.ThemeParameters.clearSelectionIcon))};return s});
//# sourceMappingURL=MultiSelectionPlugin.js.map