version: "3.8"

services:
  wrapper-apisix:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceCore/serviceApisix
        SERVICE_BIN: service-apisix
        SERVICE_PORT: 8101
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8101
    expose:
      - "8101"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-keycloak:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceCore/serviceKeycloak
        SERVICE_BIN: service-keycloak
        SERVICE_PORT: 8102
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8102
    expose:
      - "8102"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-memgraph:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/serviceMemgraph
        SERVICE_BIN: service-memgraph
        SERVICE_PORT: 8201
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8201
    expose:
      - "8201"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-qdrant:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/serviceQdrant
        SERVICE_BIN: service-qdrant
        SERVICE_PORT: 8202
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8202
    expose:
      - "8202"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-dragonfly:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/serviceDragonfly
        SERVICE_BIN: service-dragonfly
        SERVICE_PORT: 8203
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8203
    expose:
      - "8203"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-postgres-keycloak:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/servicePostgres
        SERVICE_BIN: service-postgres
        SERVICE_PORT: 8206
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8206
      - SERVICE_ID=keycloak-db
      - SERVICE_NAME=Keycloak Postgres
      - SERVICE_VERSION=15-alpine
      - UPSTREAM_URL=postgres://keycloak-db:5432/keycloak
      - SERVICE_TAGS=sql,postgres
    expose:
      - "8206"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-postgres-marquez:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/servicePostgres
        SERVICE_BIN: service-postgres
        SERVICE_PORT: 8207
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8207
      - SERVICE_ID=marquez-db
      - SERVICE_NAME=Marquez Postgres
      - SERVICE_VERSION=14-alpine
      - UPSTREAM_URL=postgres://marquez-db:5432/marquez
      - SERVICE_TAGS=sql,postgres
    expose:
      - "8207"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-marquez:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/serviceMarquez
        SERVICE_BIN: service-marquez
        SERVICE_PORT: 8204
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8204
    expose:
      - "8204"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-postgres-gitea:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/servicePostgres
        SERVICE_BIN: service-postgres
        SERVICE_PORT: 8205
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8205
      - SERVICE_ID=gitea-db
      - SERVICE_NAME=Gitea Postgres
      - SERVICE_VERSION=15-alpine
      - UPSTREAM_URL=postgres://gitea-db:5432/gitea
      - SERVICE_TAGS=sql,postgres
    expose:
      - "8205"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-postgres-registry:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceData/servicePostgres
        SERVICE_BIN: service-postgres
        SERVICE_PORT: 8209
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8209
      - SERVICE_ID=registry-db
      - SERVICE_NAME=Service Registry Postgres
      - SERVICE_VERSION=15-alpine
      - UPSTREAM_URL=postgres://registry-db:5432/service_registry
      - SERVICE_TAGS=sql,postgres
    expose:
      - "8209"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-models-huggingface:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceModels/serviceHuggingFace
        SERVICE_BIN: service-models-huggingface
        SERVICE_PORT: 8601
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8601
    expose:
      - "8601"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-models-repos:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceModels/serviceModelRepos
        SERVICE_BIN: service-models-folderrepos
        SERVICE_PORT: 8602
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8602
    expose:
      - "8602"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped

  wrapper-toolorchestra:
    build:
      context: .
      dockerfile: docker/Dockerfile.service-wrapper
      args:
        SERVICE_PATH: src/serviceModels/serviceToolOrchestra
        SERVICE_BIN: service-toolorchestra
        SERVICE_PORT: 8603
    environment:
      - RUST_LOG=info
      - SERVICE_REGISTRY_URL=http://service-registry:8100
      - SERVICE_PORT=8603
    expose:
      - "8603"
    depends_on:
      service-registry:
        condition: service_healthy
    networks:
      - nucleus_internal
    restart: unless-stopped
