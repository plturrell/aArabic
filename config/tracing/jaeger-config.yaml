# Jaeger Configuration for Distributed Tracing
# Day 7: Visualize request traces across the LLM inference pipeline
#
# This configuration enables:
# - Trace collection via OTLP protocol
# - Span storage and indexing
# - Trace visualization in Jaeger UI
# - Service dependency mapping
# - Performance analysis

# Collector configuration
collector:
  # OTLP receiver for OpenTelemetry traces
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
  
  # Jaeger native receiver (legacy support)
  jaeger:
    protocols:
      thrift_http:
        endpoint: 0.0.0.0:14268
      grpc:
        endpoint: 0.0.0.0:14250

# Storage backend
storage:
  type: badger
  badger:
    ephemeral: false
    directory_key: /badger/key
    directory_value: /badger/data
    
    # Performance tuning
    consistency: false
    maintenance_interval: 5m
    metrics_update_interval: 10s
    
    # Retention
    span_store_ttl: 168h  # 7 days

# Query service
query:
  # Base path for UI
  base_path: /

  # UI configuration
  ui:
    # Grafana integration
    dependencies:
      menuEnabled: true
      dagMaxNumServices: 200
    
    # Search configuration
    archiveEnabled: true
    
    # Service performance monitoring
    monitor:
      menuEnabled: true

# Agent configuration (for sidecar deployment)
agent:
  strategies:
    probabilistic:
      sampling_rate: 0.1  # Sample 10% of traces
    
    # Rate limiting
    rate_limiting:
      max_traces_per_second: 100

# Service performance monitoring
service_performance_monitoring:
  # Enable SPM features
  enabled: true
  
  # Metrics aggregation
  aggregation_buckets:
    - 0.001  # 1ms
    - 0.005  # 5ms
    - 0.010  # 10ms
    - 0.050  # 50ms
    - 0.100  # 100ms
    - 0.500  # 500ms
    - 1.000  # 1s
    - 5.000  # 5s

# Adaptive sampling
sampling:
  strategies:
    # Per-service sampling
    - service: llm-server
      type: probabilistic
      param: 1.0  # Sample 100% of LLM requests
    
    # Rate-based sampling for high-volume services
    - service: kv-cache
      type: rate_limiting
      param: 10  # Max 10 traces/sec
