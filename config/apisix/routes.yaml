routes:
  - id: backend-api
    name: backend-api
    uri: /api/*
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    plugins:
      openid-connect:
        discovery: http://keycloak:8080/realms/ai-nucleus/.well-known/openid-configuration
        client_id: ai-nucleus-gateway
        client_secret: "$ENV://KEYCLOAK_APISIX_CLIENT_SECRET"
        scope: "openid profile email"
        bearer_only: false
        logout_path: /api/logout
        redirect_uri: /api/.oidc/callback
        set_access_token_header: true
        access_token_in_authorization_header: true
        set_id_token_header: true
        set_userinfo_header: true
        session:
          secret: "$ENV://APISIX_OIDC_SESSION_SECRET"
          cookie:
            lifetime: 3600
      cors:
        allow_origins: "*"
        allow_methods: "GET,POST,PUT,DELETE,OPTIONS"
        allow_headers: "*"
    upstream:
      type: roundrobin
      nodes:
        backend:8000: 1

  - id: shimmy-workflows
    name: shimmy
    uri: /shimmy/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/shimmy/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        shimmy:3001: 1

  - id: langflow-ui
    name: langflow
    uri: /langflow/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/langflow/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        langflow:7860: 1

  - id: qdrant-vector
    name: qdrant
    uri: /qdrant/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/qdrant/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        qdrant:6333: 1

  - id: canvas-builder
    name: opencanvas
    uri: /canvas/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/canvas/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        opencanvas:3000: 1

  - id: hyperbook
    name: hyperbooklm
    uri: /hyperbooklm/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/hyperbooklm/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        hyperbooklm:3002: 1

  - id: gitea
    name: gitea
    uri: /git/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/git/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        gitea:3000: 1

  - id: lineage
    name: marquez
    uri: /lineage/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/lineage/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        marquez:5000: 1

  - id: nucleus-graph
    name: nucleus-graph
    uri: /graph/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/graph/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        nucleus-graph:5000: 1

  - id: keycloak-admin
    name: keycloak
    uri: /auth/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/auth/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        keycloak:8080: 1

  - id: lean4-runtime
    name: lean4
    uri: /lean4/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/lean4/(.*)"
          - "/$1"
    upstream:
      type: roundrobin
      nodes:
        lean4-runtime:8002: 1

  - id: translation-service
    name: translation
    uri: /translate/*
    plugins:
      proxy-rewrite:
        regex_uri:
          - "^/translate/(.*)"
          - "/$1"
      cors:
        allow_origins: "*"
        allow_methods: "GET,POST,OPTIONS"
        allow_headers: "*"
    upstream:
      type: roundrobin
      nodes:
        translation-rust:8010: 1
